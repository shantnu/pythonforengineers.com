<!DOCTYPE html>
<html lang="en">
<head>

    <title>Data Analysis with Pandas</title>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" type="text/css" href="../../assets/built/screen.css" />

    <link rel="canonical" href="index.html">
    <meta name="referrer" content="no-referrer-when-downgrade">
    
    
    <meta property="og:site_name" content="Python for Engineers">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Data Analysis with Pandas">
    <meta property="og:description" content="Intro: Start here
[https://new.pythonforengineers.com/blog/python-for-scientists-and-engineers/]

Beginners Start Here:

Create a Word Counter in Python
[https://new.pythonforengineers.com/blog/create-a-word-counter-in-python/]

An introduction to Numpy and Matplotlib
[https://new.pythonforengineers.com/blog/an-introduction-to-numpy-and-matplotlib/]

Introduction to Pandas with Practical Examples (New)
[https://new.pythonforengineers.com/blog/introduction-to-pandas/]

Main">
    <meta property="og:url" content="https://new.pythonforengineers.com/blog/data-analysis-with-pandas/">
    <meta property="article:published_time" content="2021-08-17T13:56:43.000Z">
    <meta property="article:modified_time" content="2021-08-17T13:56:43.000Z">
    <meta property="article:tag" content="data-science">
    <meta property="article:tag" content="pfse-book">
    
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Data Analysis with Pandas">
    <meta name="twitter:description" content="Intro: Start here
[https://new.pythonforengineers.com/blog/python-for-scientists-and-engineers/]

Beginners Start Here:

Create a Word Counter in Python
[https://new.pythonforengineers.com/blog/create-a-word-counter-in-python/]

An introduction to Numpy and Matplotlib
[https://new.pythonforengineers.com/blog/an-introduction-to-numpy-and-matplotlib/]

Introduction to Pandas with Practical Examples (New)
[https://new.pythonforengineers.com/blog/introduction-to-pandas/]

Main">
    <meta name="twitter:url" content="https://new.pythonforengineers.com/blog/data-analysis-with-pandas/">
    <meta name="twitter:label1" content="Written by">
    <meta name="twitter:data1" content="Shantnu Tiwari">
    <meta name="twitter:label2" content="Filed under">
    <meta name="twitter:data2" content="data-science, pfse-book">
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "Python for Engineers",
        "url": "https://new.pythonforengineers.com/",
        "logo": {
            "@type": "ImageObject",
            "url": "https://new.pythonforengineers.com/favicon.ico"
        }
    },
    "author": {
        "@type": "Person",
        "name": "Shantnu Tiwari",
        "image": {
            "@type": "ImageObject",
            "url": "https://new.pythonforengineers.com/content/images/2021/08/shantnu-foto-small-1.jpg"
        },
        "url": "https://new.pythonforengineers.com/author/shantnu/",
        "sameAs": []
    },
    "headline": "Data Analysis with Pandas",
    "url": "https://new.pythonforengineers.com/blog/data-analysis-with-pandas/",
    "datePublished": "2021-08-17T13:56:43.000Z",
    "dateModified": "2021-08-17T13:56:43.000Z",
    "keywords": "data-science, pfse-book",
    "description": "Intro: Start here\n[https://new.pythonforengineers.com/blog/python-for-scientists-and-engineers/]\n\nBeginners Start Here:\n\nCreate a Word Counter in Python\n[https://new.pythonforengineers.com/blog/create-a-word-counter-in-python/]\n\nAn introduction to Numpy and Matplotlib\n[https://new.pythonforengineers.com/blog/an-introduction-to-numpy-and-matplotlib/]\n\nIntroduction to Pandas with Practical Examples (New)\n[https://new.pythonforengineers.com/blog/introduction-to-pandas/]\n\nMain Book\n\nImage and Video ",
    "mainEntityOfPage": "https://new.pythonforengineers.com/blog/data-analysis-with-pandas/"
}
    </script>

    <meta name="generator" content="Ghost 5.129">
    <link rel="alternate" type="application/rss+xml" title="Python for Engineers" href="../rss/index.html">
        
    
    <link href="https://new.pythonforengineers.com/webmentions/receive/" rel="webmention">
    <script defer src="../../public/cards.min.js%3Fv=ddf1563274"></script>
    <link rel="stylesheet" type="text/css" href="../../public/cards.min.css%3Fv=ddf1563274.css">
    <script defer src="../../public/member-attribution.min.js%3Fv=ddf1563274"></script><style>:root {--ghost-accent-color: #FF1A75;}</style>
    <link rel="stylesheet" href="/assets/css/prism-okaidia.min.css" integrity="sha512-mIs9kKbaw6JZFfSuo+MovjU+Ntggfoj8RwAmJbVXQ5mkAX5LlgETQEweFPI18humSPHymTb5iikEOKWF7I8ncQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<link rel="stylesheet" href="/assets/css/prism-toolbar.min.css" />

</head>
<body class="post-template tag-data-science tag-pfse-book">
<div class="viewport">

    <header id="gh-head" class="gh-head ">
        <nav class="gh-head-inner inner gh-container">

            <div class="gh-head-brand">
                <a class="gh-head-logo" href="../../home/index.html">
                        Python for Engineers
                </a>
                <a class="gh-burger" role="button">
                    <div class="gh-burger-box">
                        <div class="gh-burger-inner"></div>
                    </div>
                </a>
            </div>
            <div class="gh-head-menu">
                <ul class="nav">
    <li class="nav-home"><a href="../../home/index.html">Home</a></li>
    <li class="nav-about-contact"><a href="../../about/index.html">About/Contact</a></li>
    <li class="nav-books"><a href="../../books.html">Books</a></li>
    <li class="nav-blog"><a href="../../author/Shantnu/index.html">Blog</a></li>
    <li class="nav-search"><a href="index.html#/search">Search</a></li>
</ul>

            </div>
            <div class="gh-head-actions">
                <div class="gh-social">
                </div>

                    <a class="gh-head-button" href="index.html#/portal/signup">Subscribe</a>
            </div>
        </nav>
    </header>

    <main>
        



<article class="article post tag-data-science tag-pfse-book no-image">

    <header class="article-header gh-canvas">

        <section class="article-tag">
            <a href="../../tag/data-science/index.html">data-science</a>
        </section>

        <h1 class="article-title">Data Analysis with Pandas</h1>


        <div class="article-byline">
            <section class="article-byline-content">
                <ul class="author-list">
                    <li class="author-list-item">
                        <a href="../../author/Shantnu/index.html" class="author-avatar">
                            <img class="author-profile-image" src="../../content/images/size/w100/2021/08/shantnu-foto-small-1.jpg" alt="Shantnu Tiwari" />
                        </a>
                    </li>
                </ul>
                <div class="article-byline-meta">
                    <h4 class="author-name"><a href="../../author/Shantnu/index.html">Shantnu Tiwari</a></h4>
                    <div class="byline-meta-content">
                        <time class="byline-meta-date" datetime="2021-08-17">Aug 17, 2021</time>
                        <span class="byline-reading-time"><span class="bull">&bull;</span> 15 min read</span>
                    </div>
                </div>
            </section>
        </div>

    </header>

    <section class="gh-content gh-canvas">
        <p><a href="../python-for-scientists-and-engineers/index.html"><strong>Intro: Start here</strong></a></p><p><strong>Beginners Start Here:</strong></p><p><a href="../create-a-word-counter-in-python/index.html"><strong>Create a Word Counter in Python</strong></a></p><p><a href="../an-introduction-to-numpy-and-matplotlib/index.html"><strong>An introduction to Numpy and Matplotlib</strong></a></p><p><a href="../introduction-to-pandas/index.html"><strong>Introduction to Pandas with Practical Examples (New)</strong></a></p><p><strong>Main Book</strong></p><p><a href="../image-and-video-processing-in-python/index.html"><strong>Image and Video Processing in Python</strong></a></p><p><a href="index.html"><strong>Data Analysis with Pandas</strong></a></p><p><a href="../audio-and-digital-signal-processingdsp-in-python/index.html"><strong>Audio and Digital Signal Processing (DSP)</strong></a></p><p><strong>Machine Learning Section</strong></p><p><a href="../machine-learning-with-an-amazon-like-recommendation-engine/index.html"><strong>Machine Learning with an Amazon like Recommendation Engine</strong></a></p><!--kg-card-begin: markdown--><p>You must have seen in Chapter on plotting that Python can be used to parse csv files. You might also have noted that it is fairly painful. While there are libraries like <em>csv_reader()</em>, they still aren’t perfect. You still have to do a lot of stuff manually.</p>
<p>Enter Pandas, which is a great library for data analysis. It is quite high level, so you don’t have to muck about with low level details, unless you really want to.</p>
<p>If you are dealing with complicated or large datasets, seriously consider Pandas. It is based on numpy/scipy, sort of a superset of it. But it gives you a lot of powerful features, like read directly from a Microsoft Excel file, do data joins (like you would do in SQL) etc, some of which features we will go over.</p>
<p>Just one more thing before we continue. Pandas has two basic data structures: Series and Dataframes.</p>
<p>Series is like numpy’s array/dictionary, though it comes with a lot of extra features. Dataframes is a two dimensional data structure that contains both column and row information, like the fields of an Excel file. Remember an Excel file has rows and columns, and an optional header field. All of this data can be represented in a Dataframe. That’s what we’ll use in our examples below.</p>
<h2 id="installing-pandas">Installing pandas</h2>
<p>You should get Pandas if you installed Anaconda, as recommended.</p>
<p><em>Note to people without a graphical interface: If you can’t view the graphs because you have no GUI, you can save the graphs instead. <a href="https://stackoverflow.com/questions/9622163/save-plot-to-image-file-instead-of-displaying-it-using-matplotlib?ref=new.pythonforengineers.com">See here for details</a>.</em></p>
<h2 id="analyse-obesity-in-england">Analyse obesity in England</h2>
<p>I’m using the 2014 data from here:</p>
<p><a href="https://data.gov.uk/dataset/statistics_on_obesity_physical_activity_and_diet_england?ref=new.pythonforengineers.com">https://data.gov.uk/dataset/statistics_on_obesity_physical_activity_and_diet_england</a></p>
<p>I’ll also put it in the Github directory, so you don’t have to download it. Make sure you open the file in Excel (or Openoffice) and view it, so you know what we’re talking about. Do that now, and have a look at the different sections. Especially section 7.1 and 7.2, as that’s what we’ll focus on.</p>
<p>Let’s get started then.</p>
<pre><code class="language-python">import pandas as pd
import matplotlib.pyplot as plt

</code></pre>
<p>Pandas is imported as <em>pd</em> to save typing, in the same way we import numpy as <em>np</em>.</p>
<pre><code class="language-python">data = pd.ExcelFile(&quot;Obes-phys-acti-diet-eng-2014-tab.xls&quot;)
print(data.sheet_names)

</code></pre>
<p>We are opening the <em>xls</em> file. The great thing about pandas is that you can open Excel files directly. Normally, most libraries can only work with <em>csv</em> files. We then print all the sheet names.</p>
<pre><code class="language-python">['Chapter 7', '7.1', '7.2', '7.3', '7.4', '7.5', '7.6', '7.7', '7.8', '7.9', '7.10']

</code></pre>
<p>For those of you not comfortable with Excel, a sheet is one “page”, as it were, of data. Rather than having all the data in one huge unmanageable sheet, users break the data into multiple sheets. Above, we printed all the available sheets.</p>
<h3 id="section-71-obesity-by-gender">Section 7.1: Obesity by gender</h3>
<p>Let’s have a look at sheet 1:</p>
<p><img src="../../content/images/2021/08/pandas1.jpg" alt="pandas1" loading="lazy"></p>
<p>There are four columns: <em>Year</em>, <em>total</em>, <em>males</em> and <em>females</em>. The <em>Year</em> column doesn’t have a header- if you look at line 5, you will see the header for year is empty.</p>
<p>I’ll show you two ways to read in data. In the first one, you define the header columns yourself.</p>
<pre><code class="language-python"># Define the columns to be read
columns1 = ['year', 'total', 'males', 'females']


</code></pre>
<p>So I’m defining a list with four header entries: ‘year’, ‘total’, ‘males’ and ‘females’.</p>
<pre><code class="language-python">data_gender = data.parse(u'7.1', skiprows=4, skipfooter=14, names=columns1)

</code></pre>
<p>We read sheet <em>7.1</em>. If you look at the actual sheet, the top 4 and bottom 14 rows contain useless info, so we skip it (<em>skiprows=4, skipfooter=14,</em> ). Finally, we tell pandas to name the column headers using our list <em>names=columns1</em> .</p>
<p>We then print <em>data_gender</em>.</p>
<pre><code class="language-python">print(data_gender)

</code></pre>
<pre><code class="language-python">       year  total  males  females
0       NaN    NaN    NaN      NaN
1   2002/03   1275    427      848
2   2003/04   1711    498     1213
3   2004/05   2035    589     1442
 &lt; snip &gt;
</code></pre>
<p>If you look at the entry for 0, it is <em>NaN</em>. Why’s that? Look at the original spreadsheet. There is an empty space on line 6, to make the sheet easier to read. Since it is empty, it is read as Not A Number (NaN) by pandas. How do we get rid of it? Easy.</p>
<pre><code class="language-python"># Remove the N/A from the data
data_gender.dropna(inplace = True)

</code></pre>
<p>Using the inbuilt <em>dropna()</em> function, of course. <em>inplace = True</em> means modify the existing Dataframe. If we look at the output again:</p>
<pre><code class="language-python">       year  total  males  females
1   2002/03   1275    427      848
2   2003/04   1711    498     1213
3   2004/05   2035    589     1442

 &lt; snip &gt;
</code></pre>
<p>we see the <em>NaN</em> values are now gone. There is another problem, though. We have an index at the beginning (the first column, going 1,2,3….). We don’t need an index. Instead, we want the year to be the index. Let’s fix that next.</p>
<pre><code class="language-python">data_gender.set_index('year', inplace=True)
print(data_gender)

</code></pre>
<pre><code class="language-python">total  males  females
year
2002/03   1275    427      848
2003/04   1711    498     1213
2004/05   2035    589     1442


</code></pre>
<p>That’s better.</p>
<pre><code class="language-python"># Plot all
data_gender.plot()
plt.show()

</code></pre>
<p><img src="../../content/images/2021/08/pandas2.png" alt="pandas2" loading="lazy"></p>
<p>We can see that while obesity for men has gone up, obesity for women has gone up more strongly.</p>
<h3 id="section-72-obesity-by-age">Section 7.2: Obesity by age</h3>
<p><img src="../../content/images/2021/08/pandas3.jpg" alt="pandas3" loading="lazy"></p>
<p>We will read the data slightly differently this time. Last time, we defined the headers ourself. This time, we’ll let pandas pick them up.</p>
<pre><code class="language-python"># Read 2nd section, by age
data_age  = data.parse('7.2', skiprows=4, skipfooter=14)
print(data_age)

</code></pre>
<pre><code class="language-python">Unnamed: 0  Total  Under 16  16-24  25-34  35-44  45-54  55-64  65-74
0         NaN    NaN       NaN    NaN    NaN    NaN    NaN    NaN    NaN
1     2002/03   1275       400     65    136    289    216     94     52


</code></pre>
<p>If you remember, the year column didn’t have a header, which is why pandas names it <em>Unnamed</em>. Let’s rename it:</p>
<pre><code class="language-python"># Rename unames to year
data_age.rename(columns={'Unnamed: 0': 'Year'}, inplace=True)
print(data_age)

</code></pre>
<pre><code class="language-python">Year  Total  Under 16  16-24  25-34  35-44  45-54  55-64  65-74
0       NaN    NaN       NaN    NaN    NaN    NaN    NaN    NaN    NaN
1   2002/03   1275       400     65    136    289    216     94     52


</code></pre>
<p>That’s better. Let’s drop the Nan and set the index to year.</p>
<pre><code class="language-python"># Drop empties and reset index
data_age.dropna(inplace=True)
data_age.set_index('Year', inplace=True)
print(data_age)

</code></pre>
<pre><code class="language-python">Total  Under 16  16-24  25-34  35-44  45-54  55-64  65-74
Year
2002/03   1275       400     65    136    289    216     94     52
2003/04   1711       579     67    174    391    273    151     52


</code></pre>
<p>Let’s plot all the ages first.</p>
<pre><code class="language-python">data_age.plot()
plt.show()

</code></pre>
<p><img src="../../content/images/2021/08/pandas7.png" alt="pandas7" loading="lazy"></p>
<p>You see a big problem: The <em>Total</em> column is huge and suppresses the other graphs. So we need to get rid of it to make the graph clearer.</p>
<pre><code class="language-python"># Plotting everything cause total to override everything. So drop it.

# Drop the total column and plot
data_age_minus_total = data_age.drop('Total', axis = 1)


</code></pre>
<p>The <em>drop()</em> function can drop entries from a table. Here, we are dropping the <em>Total</em> column.</p>
<pre><code class="language-python">data_age_minus_total.plot()
plt.show()

</code></pre>
<p><img src="../../content/images/2021/08/pandas4.png" alt="pandas4" loading="lazy"></p>
<p>We can quickly see that the age groups 35-44 and 45-54 have had the highest obesity growth.</p>
<p>What if we want to compare age groups? How do children compare to adults?</p>
<p>In Pandas, you can view any column by doing <em>data_age[column_name]</em>.</p>
<pre><code class="language-python">print(data_age['Under 16'])

</code></pre>
<pre><code class="language-python">Year
2002/03    400
2003/04    579
2004/05    547
2005/06    583


</code></pre>
<p>This gives the data for just the under 16s. We can plot any age group this way.</p>
<pre><code class="language-python">#Plot children vs adults
data_age['Under 16'].plot(label = &quot;Under 16&quot;)
data_age['25-34'].plot(label = &quot;25-34&quot;)
plt.legend(loc=&quot;upper right&quot;)
plt.show()


</code></pre>
<p><img src="../../content/images/2021/08/pandas5.png" alt="pandas5" loading="lazy"></p>
<p>We see that while children’s obesity has gone down, that for adults has ballooned. Maybe adults should start following the advice they give to children?</p>
<h2 id="movie-lens">Movie Lens</h2>
<p>The movie lens database is a collection of data based on users reviews of movies. It is one of the most popular open datasets out there. Download it from <a href="https://grouplens.org/datasets/movielens/?ref=new.pythonforengineers.com">https://grouplens.org/datasets/movielens/</a>, downloading the 100K version.</p>
<p>It is also different that the data isn’t in an Excel format, but plain text. This makes it easy to parse. Now, we have seen that Python pandas makes parsing Excel files easy as well, but many programming languages don’t have this feature.</p>
<p>Download the data and have a look at it. There is a large amount of data, and we will only work with a small subset. If you want to know the details of the files, they are in the Readme.</p>
<p>In a text editor, open the first file we will work with, <em>u.item</em>:</p>
<pre><code class="language-python">1|Toy Story (1995)|01-Jan-1995||https://us.imdb.com/M/title-exact?Toy%20Story%20(1995)|0|0|0|1|1|1|0|0|0|0|0|0|0|0|0|0|0|0|0
2|GoldenEye (1995)|01-Jan-1995||https://us.imdb.com/M/title-exact?GoldenEye%20(1995)|0|1|1|0|0|0|0|0|0|0|0|0|0|0|0|0|1|0|0
3|Four Rooms (1995)|01-Jan-1995||https://us.imdb.com/M/title-exact?Four%20Rooms%20(1995)|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|1|0|0

</code></pre>
<p>It contains the data movie id, movie name, release date, imdb.com link, and a series of flags for genre. These are separated by a pipe ( <em>|</em> ).<br>
I will only use the first two of the entries (movie id and name).<br>
Open <em>u.user</em>:</p>
<pre><code class="language-python">1|24|M|technician|85711
2|53|F|other|94043
3|23|M|writer|32067

</code></pre>
<p>The details are user id, age, gender, occupation and post code. By the way, these details are in the Readme, if you forget.<br>
Again, I will only use the first three enteries (id, age and gender).</p>
<p>Finally, we have <em>u.data</em></p>
<pre><code class="language-python">196    242    3    881250949
186    302    3    891717742
22    377    1    878887116

</code></pre>
<p>The entries are user id, movie id, rating and timestamp (which I’ll ignore in this example).</p>
<p>If you look at the other files, you’ll see there is a wealth of data. You can draw many conclusions from the data, which is why the dataset is so popular.</p>
<p>We’ll focus on a small set of the data, mainly on how users of different ages and genders rated movies.</p>
<p><strong>Reading the data</strong></p>
<p>Since the data is plain text separated by <em>|</em>, it will not have column headers like Excel files. Which means, we’ll have to provide our own, like I did in the first part of the last section.</p>
<p>Pandas has a function to read plain text files, which is a lot similar to numpy’s read file functions we covered in chapter on plotting (not surprising, since pandas is based in numpy).</p>
<p>On to the code.</p>
<pre><code class="language-python">user_columns = ['user_id', 'age', 'sex']


</code></pre>
<p>We declare <em>user_columns</em> for the three entries we want to read from <em>u.user</em>. Note that <em>u.user</em> has more than three entries per row, but we will ignore the others.</p>
<pre><code class="language-python">users = pd.read_csv('u.user', sep='|', names=user_columns, usecols=range(3))

</code></pre>
<p>We will use the <em>read_csv</em> function to read the file, even though it isn’t technically a csv(comma separated values) file. The first argument is the file name. The second says that our values are separated by <em>|</em>. The third argument merely passes in our <em>user_columns</em> as the column names. The final argument says that we need to only read three values per row. Without this, pandas will try to read the whole line and cause a mess.</p>
<p>In exactly the same way, we load the other values as well:</p>
<pre><code class="language-python">rating_columns = ['user_id', 'movie_id', 'rating']
ratings = pd.read_csv('u.data', sep='\t', names=rating_columns,  usecols=range(3))

movie_columns = ['movie_id', 'title']
movies = pd.read_csv('u.item', sep='|', names=movie_columns, usecols=range(2), encoding=&quot;iso-8859-1&quot;)
</code></pre>
<p>Now comes the important part. The data in the movielens dataset is spread over multiple files. But that is no good to us. We need to merge it together, so we can analyse it in one go. If you have used Sql, you will know it has a JOIN function to join tables. Pandas has something similar.</p>
<p>Finally, we’ve added <em><span class="pl-v">encoding</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds"></span>iso-8859-1<span class="pl-pds"></span></span></em>. This is to keep Python 3 happy, as the file contains non-standard characters, and while Python 2 had a W_ink wink, I’ll let you get away with it approach_, Python 3 is more strict. We need to make sure we specify that we are using Latin-1 encoding (which is just plain English).</p>
<pre><code class="language-python"># create one merged DataFrame
movie_ratings = pd.merge(movies, ratings)
movie_data = pd.merge(movie_ratings, users)

</code></pre>
<p>The <em>merge()</em> function will do the same thing. It will take two different DataFrames and merge them together. You can specify an index to merge them on, but pandas is smart enough to find the common index and merge on it.</p>
<p>So for the first merge:</p>
<pre><code class="language-python">movie_ratings = pd.merge(movies, ratings)

</code></pre>
<p>pandas will see that <em>movie_id</em> is common between <em>movies</em> and <em>ratings</em>, so will merge on that.</p>
<p>We then merge this newly created <em>movie_ratings</em> with <em>users</em>:</p>
<pre><code class="language-python">movie_data = pd.merge(movie_ratings, users)

</code></pre>
<p>Again, pandas will figure out <em>user_id</em> is common and merge around that.</p>
<p>The final result is a dataset that contains all the info we need, so we can start working on it.</p>
<pre><code class="language-python"># Top rated movies
print(&quot;Top rated movies (overall):\n&quot;), movie_data.groupby('title').size().sort_values(ascending=False)[:20]

</code></pre>
<p>The first thing we are going to do is find movies which have the most ratings. The code above may look big and confusing, but this is actually a feature of Python: You can chain multiple commands. Let’s break it down.</p>
<pre><code class="language-python">movie_data.groupby('title')

</code></pre>
<p>The <em>groupby()</em> function allows you to group the data by a chosen column (remember, the data in normally printed by index. Here, we are saying arrange the data by title, not index).</p>
<pre><code class="language-python">movie_data.groupby('title').size()

</code></pre>
<p>After we have the movies by title, we call the <em>size()</em> function to arrange them by size. Normall, this is in ascending order, so:</p>
<pre><code class="language-python">movie_data.groupby('title').size().sort_values(ascending=False)[:20]

</code></pre>
<p>we call the <em>sort_values(ascending=False)</em> function, which arranged the data in descending order (so movies with more ratings appear at top). Finally, we use <em>[:20]</em> to only show the top 20 movies.</p>
<pre><code class="language-python">Top rated movies (overall):
title
Star Wars (1977)                    583
Contact (1997)                      509
Fargo (1996)                        508
Return of the Jedi (1983)           507
Liar Liar (1997)                    485
English Patient, The (1996)         481
Scream (1996)                       478
Toy Story (1995)                    452
Air Force One (1997)                431
Independence Day (ID4) (1996)       429
Raiders of the Lost Ark (1981)      420
Godfather, The (1972)               413
Pulp Fiction (1994)                 394
Twelve Monkeys (1995)               392
Silence of the Lambs, The (1991)    390
Jerry Maguire (1996)                384
Chasing Amy (1997)                  379
Rock, The (1996)                    378
Empire Strikes Back, The (1980)     367
Star Trek: First Contact (1996)     365
dtype: int64

</code></pre>
<p>The second number is the number of votes. So Star Wars has 583 votes, making it the highest rated movie.</p>
<p>To no one’s surprise, all the Star War movies are there (only the real ones, none of that Jar Jar Binks garbage). Scream and Liar Liar were a bit surprising, as they aren’t really classics. But as we’ll see later, some people may consider them classics.</p>
<p>Let’s compare how the tastes of teenagers(13-19) vs the oldies (60+) differ.</p>
<p>If you want to see all movies rated by people greater than 60 years, the easiest way is:</p>
<pre><code class="language-python">movie_data[movie_data.age &gt; 60]
</code></pre>
<p>You just pass <em>movie_data.age &gt; 60</em> to itself, and pandas will return a DataFrame which meets this condition. Let’s do that now:</p>
<pre><code class="language-python">oldies = movie_data[(movie_data.age &gt; 60)]
</code></pre>
<p>This will return the movies sorted by index. We want the movies sorted by number of votes (as above). Let’s do that now:</p>
<pre><code class="language-python"># Get the top rated ones
oldies = oldies.groupby('title').size().sort_values(ascending=False)


</code></pre>
<p>This is the same code as above, except this time we will see the top rated movies by old people only.</p>
<p>Let’s do the same for teenagers.</p>
<pre><code class="language-python"># Extract movies for teens
teens = movie_data[(movie_data.age &gt; 12) &amp; (movie_data.age &lt; 20)]
# Get the top rated ones
teens = teens.groupby('title').size().sort_values(ascending=False)
</code></pre>
<p>I’m doing the same as above, except this time I have two checks : <em>(movie_data.age &gt; 12) &amp; (movie_data.age &lt; 20)</em>. We can have as many checks as we want. We could have added a <em>movie_data.gender == ‘F’</em> if we wanted teenage girls.</p>
<p>In the next line, again we sort by number of votes.</p>
<p>And now, let’s print the results, only printing the top 10 results:</p>
<pre><code class="language-python">print(&quot;Top ten movies for oldies: \n&quot;, oldies[:10])

</code></pre>
<pre><code class="language-python">Top ten movies for oldies:
title
English Patient, The (1996)    17
Fargo (1996)                   12
Full Monty, The (1997)         10
Titanic (1997)                 10
Godfather, The (1972)           9
Seven Years in Tibet (1997)     9
Air Force One (1997)            9
Evita (1996)                    9
L.A. Confidential (1997)        8
Volcano (1997)                  8
dtype: int64

</code></pre>
<pre><code class="language-python">print(&quot;Top ten movies for teens: \n&quot;, teens[:10])

</code></pre>
<pre><code class="language-python">Top ten movies for teens:
Scream (1996)                    65
Contact (1997)                   49
Liar Liar (1997)                 47
Star Wars (1977)                 45
Return of the Jedi (1983)        43
Independence Day (ID4) (1996)    41
Titanic (1997)                   36
Toy Story (1995)                 35
Chasing Amy (1997)               35
Twelve Monkeys (1995)            35


</code></pre>
<p>You can see that Scream is only liked by teenagers. The English Patient is the older people’s favourite. But note that it only has 17 votes, which maybe just the fact that there are fewer older people compared to teenagers.</p>
<p>Let’s now compare the the ratings by gender.</p>
<pre><code class="language-python">ratings_by_title = movie_data.groupby('title').size()

</code></pre>
<p>We get the ratings by size.</p>
<pre><code class="language-python">popular_movies = ratings_by_title.index[ratings_by_title &gt;= 250]
</code></pre>
<p>We want to avoid movies that have one review. So we are only selecting those movies with at least 250 reviews. This is an arbitrary number. This will help us filter out popular movies only.</p>
<p>The next feature is very powerful. Say you want to reshape a dataset. You could perform multiple select and join operations. But the <em>pivot_table()</em> function allows us to do this more simply. Here, I want to create a new table which has the ratings of the movies selected by gender.</p>
<pre><code class="language-python">ratings_by_gender = movie_data.pivot_table('rating', index='title',columns='gender')

</code></pre>
<p>The <em>pivot_table()</em> takes the <em>movie_data</em> and reshapes it. The first argument says we want to arrange it by rating. The second argument says that the index should be the title, and the third says the columns should be based on gender. Let’s see what we get:</p>
<pre><code class="language-python">print(&quot;Top rated movies by women \n&quot;, top_movies_women.head())

gender                                              F         M
title
'Til There Was You (1997)                    2.200000  2.500000
1-900 (1994)                                 1.000000  3.000000
101 Dalmatians (1996)                        3.116279  2.772727
12 Angry Men (1957)                          4.269231  4.363636

</code></pre>
<p>You can see we have a new table that shows the ratings by gender. But it has a lot of movies that may only have one or two ratings.</p>
<pre><code class="language-python">ratings_by_gender = ratings_by_gender.loc[popular_movies]

</code></pre>
<p>The <em>.loc</em> is another way to select data. We are selecting the data that is in <em>popular_movies</em> only, which means it has at least 250 ratings. If I print <em>ratings_by_gender</em> now:</p>
<pre><code class="language-python">gender                               F         M
title
2001: A Space Odyssey (1968)  3.491228  4.103960
Air Force One (1997)          3.690476  3.606557
Alien (1979)                  3.660714  4.123404
Aliens (1986)                 3.672727  4.013100
Amadeus (1984)                4.038961  4.211055
Apollo 13 (1995)              4.000000  3.909953


</code></pre>
<p>That’s better. We are getting movies we’ve heard of.</p>
<p>Let’s see which movies were top rated by women:</p>
<pre><code class="language-python">top_movies_women = ratings_by_gender.sort_values(by='F', ascending=False)

</code></pre>
<p>You should understand what’s going on by now. We are sorting <em>ratings_by_gender</em> by the ‘F’ column, which remember, stands for female. Let’s print that:</p>
<pre><code class="language-python">print(&quot;Top rated movies by women \n&quot;, top_movies_women.head())

</code></pre>
<pre><code class="language-python">Top rated movies by women

gender                                         F         M
title
Schindler's List (1993)                 4.632911  4.406393
Shawshank Redemption, The (1994)        4.562500  4.410959
Usual Suspects, The (1995)              4.333333  4.399061
Silence of the Lambs, The (1991)        4.320000  4.279310
Titanic (1997)                          4.278846  4.231707
Sense and Sensibility (1995)            4.252632  3.878613

</code></pre>
<p>As you can see, most top rated movies by women also got high ratings by men. Except for the last one, <em>Sense and Sensibility (1995)</em>. Are there other movies men and women disagree on?</p>
<p>We are going to add a new column to our table, which will calculate the difference between the men and women’s ratings:</p>
<pre><code class="language-python">ratings_by_gender['diff'] = ratings_by_gender['M'] - ratings_by_gender['F']

</code></pre>
<p>Here, <em>diff</em> is a new column. This is what it will look like:</p>
<pre><code class="language-python">print(&quot;Difference by gender \n&quot;, ratings_by_gender.head())

</code></pre>
<pre><code class="language-python">Difference by gender

gender                               F         M      diff
title
2001: A Space Odyssey (1968)  3.491228  4.103960  0.612732
Air Force One (1997)          3.690476  3.606557 -0.083919
Alien (1979)                  3.660714  4.123404  0.462690
Aliens (1986)                 3.672727  4.013100  0.340373


</code></pre>
<p>Now, we want to see which movies had the greatest difference in votes. After I wrote this code, I saw Wes McKinney’s book on Pandas (Wes wrote the Pandas library), and he too used this example. He used standard deviation, which I guess will give a more accurate answer. I use the simple absolute value (the absolute value of the <em>diff</em> parameter we created).</p>
<pre><code class="language-python">gender_diff = ratings_by_gender['diff']

</code></pre>
<p>I store just the differences in a new DataFrame.</p>
<pre><code class="language-python"># Only get absolute values
gender_diff = abs(gender_diff)

</code></pre>
<p>And get the absolute values, to remove the negative sign.</p>
<pre><code class="language-python">#Sort by size
gender_diff.sort_values(inplace=True, ascending = False)

</code></pre>
<p>Sort it by descending size, so the biggest differences will show up on top. And finally, we graph it:</p>
<pre><code class="language-python"># Show top 10 differences

gender_diff[:10].plot(kind='barh')
plt.show()

</code></pre>
<p>The barh is a type of bar graph, except it is drawn in the horizontal direction:</p>
<p>!<img src="../../content/images/2021/08/pandas6.png" alt="pandas6" loading="lazy"></p>
<h2 id="conclusion">Conclusion</h2>
<p>That was a quick intro to Pandas. My advice is, search for some open data (just Google open data. Many countries, like the UK and USA, put a lot of their government data online for free) and find something you like. Pandas is quite easy to use, and there is a lot of help online. Any time you get stuck, just Google it.</p>
<!--kg-card-end: markdown-->
    </section>


</article>



<aside class="read-more-wrap">
    <div class="read-more inner">


                    
<article class="post-card post no-image ">


    <div class="post-card-content">

        <a class="post-card-content-link" href="../awesome-python-library-tenacity/index.html">
            <header class="post-card-header">
                <h2 class="post-card-title">Awesome Python Library: Tenacity</h2>
            </header>
            <section class="post-card-excerpt">
                <p>Link: https://tenacity.readthedocs.io/en/latest/

When writing code or tests in Python, one issue I had was when the code would fail due to random things like network issues or external peripherals not responding in time. Just rerunning the tests would make them pass. The unreliability wasn&#39;</p>
            </section>
        </a>

        <footer class="post-card-meta">
            <ul class="author-list">
                <li class="author-list-item">
                    <a href="../../author/Shantnu/index.html" class="static-avatar">
                        <img class="author-profile-image" src="../../content/images/size/w100/2021/08/shantnu-foto-small-1.jpg" alt="Shantnu Tiwari" />
                    </a>
                </li>
            </ul>
            <div class="post-card-byline-content">
                <span><a href="../../author/Shantnu/index.html">Shantnu Tiwari</a></span>
                <span class="post-card-byline-date"><time datetime="2024-04-10">Apr 10, 2024</time> <span class="bull">&bull;</span> 2 min read</span>
            </div>
        </footer>

    </div>

</article>
                    
<article class="post-card post no-image ">


    <div class="post-card-content">

        <a class="post-card-content-link" href="../so-evidently/index.html">
            <header class="post-card-header">
                <h2 class="post-card-title">So Google&#x27;s Gemini Doesn&#x27;t Like Python Programming and Sanskrit?</h2>
            </header>
            <section class="post-card-excerpt">
                <p>I have been playing around with Googles Gemini Pro.

Recently, I wanted to write a blog on Python&#39;s decorators and wanted to get some ideas for practical projects I could build with them. Tried GPT4 first, it gave me the standard &quot;log analyser&quot; that all blogs</p>
            </section>
        </a>

        <footer class="post-card-meta">
            <ul class="author-list">
                <li class="author-list-item">
                    <a href="../../author/Shantnu/index.html" class="static-avatar">
                        <img class="author-profile-image" src="../../content/images/size/w100/2021/08/shantnu-foto-small-1.jpg" alt="Shantnu Tiwari" />
                    </a>
                </li>
            </ul>
            <div class="post-card-byline-content">
                <span><a href="../../author/Shantnu/index.html">Shantnu Tiwari</a></span>
                <span class="post-card-byline-date"><time datetime="2024-02-25">Feb 25, 2024</time> <span class="bull">&bull;</span> 4 min read</span>
            </div>
        </footer>

    </div>

</article>
                    
<article class="post-card post ">

    <a class="post-card-image-link" href="../linkedin-has-become-a-piece-of-garbage-even-more-than-usual/index.html">
        <img class="post-card-image"
            srcset="../../content/images/size/w300/2024/01/ae223740-840b-4d4a-9467-2522a67dcbbc.png 300w,
                   ../../content/images/size/w600/2024/01/ae223740-840b-4d4a-9467-2522a67dcbbc.pngg 600w,
                  ../../content/images/size/w1000/2024/01/ae223740-840b-4d4a-9467-2522a67dcbbc.pngng 1000w,
                 ../../content/images/size/w2000/2024/01/ae223740-840b-4d4a-9467-2522a67dcbbc.pngpng 2000w"
            sizes="(max-width: 1000px) 400px, 800px"
            src="../../content/images/size/w600/2024/01/ae223740-840b-4d4a-9467-2522a67dcbbc.png"
            alt="LinkedIn Has Become a Pile of Garbage (even more than usual)"
            loading="lazy"
        />
    </a>

    <div class="post-card-content">

        <a class="post-card-content-link" href="../linkedin-has-become-a-piece-of-garbage-even-more-than-usual/index.html">
            <header class="post-card-header">
                <h2 class="post-card-title">LinkedIn Has Become a Pile of Garbage (even more than usual)</h2>
            </header>
            <section class="post-card-excerpt">
                <p>Online forums, especially Hacker News and Reddit, are very hostile to LinkedIn. Everyone makes fun of the self-promotion and silliness that goes there. There are complaints the site is unusable, which I didn&#39;t agree with until now.

I&#39;ve had an account there for a few years.</p>
            </section>
        </a>

        <footer class="post-card-meta">
            <ul class="author-list">
                <li class="author-list-item">
                    <a href="../../author/Shantnu/index.html" class="static-avatar">
                        <img class="author-profile-image" src="../../content/images/size/w100/2021/08/shantnu-foto-small-1.jpg" alt="Shantnu Tiwari" />
                    </a>
                </li>
            </ul>
            <div class="post-card-byline-content">
                <span><a href="../../author/Shantnu/index.html">Shantnu Tiwari</a></span>
                <span class="post-card-byline-date"><time datetime="2024-01-29">Jan 29, 2024</time> <span class="bull">&bull;</span> 4 min read</span>
            </div>
        </footer>

    </div>

</article>

    </div>
</aside>


    </main>

    <footer class="site-footer outer">
        <div class="inner">
            <section class="copyright"><a href="../../home/index.html">Python for Engineers</a> &copy; 2025</section>
            <nav class="site-footer-nav">
                
            </nav>
            

        </div>
    </footer>

</div>


<script
    src="/assets/js/jquery-3.5.1.min.js"
    integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
    crossorigin="anonymous">
</script>
<script src="../../assets/built/casper.js"></script>
<script>
$(document).ready(function () {
    // Mobile Menu Trigger
    $('.gh-burger').click(function () {
        $('body').toggleClass('gh-head-open');
    });
    // FitVids - Makes video embeds responsive
    $(".gh-content").fitVids();
});
</script>

<script src="/assets/js/prism.min.js" integrity="sha512-axJX7DJduStuBB8ePC8ryGzacZPr3rdLaIDZitiEgWWk2gsXxEFlm4UW0iNzj2h3wp5mOylgHAzBzM4nRSvTZA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>



<script src="/assets/js/prism-toolbar.min.js" integrity="sha512-YrvgEHAi5/3o2OT+/vh1z19oJXk/Kk0qdVKbjEFl9VRmcLTaWRYzVziZCvoGpJ2TrnV7rB8pnJcz1ioVJjgw2A==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

</body>
</html>
