<!DOCTYPE html>
<html lang="en">
<head>

    <title>Audio and Digital Signal Processing(DSP) in Python</title>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" type="text/css" href="../../assets/built/screen.css" />

    <link rel="canonical" href="index.html">
    <meta name="referrer" content="no-referrer-when-downgrade">
    
    
    <meta property="og:site_name" content="Python for Engineers">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Audio and Digital Signal Processing(DSP) in Python">
    <meta property="og:description" content="Intro: Start here
[https://new.pythonforengineers.com/blog/python-for-scientists-and-engineers/]

Beginners Start Here:

Create a Word Counter in Python
[https://new.pythonforengineers.com/blog/create-a-word-counter-in-python/]

An introduction to Numpy and Matplotlib
[https://new.pythonforengineers.com/blog/an-introduction-to-numpy-and-matplotlib/]

Introduction to Pandas with Practical Examples (New)
[https://new.pythonforengineers.com/blog/introduction-to-pandas/]

Main">
    <meta property="og:url" content="https://new.pythonforengineers.com/blog/audio-and-digital-signal-processingdsp-in-python/">
    <meta property="article:published_time" content="2021-08-17T14:03:23.000Z">
    <meta property="article:modified_time" content="2021-08-17T14:03:23.000Z">
    <meta property="article:tag" content="pfse-book">
    
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Audio and Digital Signal Processing(DSP) in Python">
    <meta name="twitter:description" content="Intro: Start here
[https://new.pythonforengineers.com/blog/python-for-scientists-and-engineers/]

Beginners Start Here:

Create a Word Counter in Python
[https://new.pythonforengineers.com/blog/create-a-word-counter-in-python/]

An introduction to Numpy and Matplotlib
[https://new.pythonforengineers.com/blog/an-introduction-to-numpy-and-matplotlib/]

Introduction to Pandas with Practical Examples (New)
[https://new.pythonforengineers.com/blog/introduction-to-pandas/]

Main">
    <meta name="twitter:url" content="https://new.pythonforengineers.com/blog/audio-and-digital-signal-processingdsp-in-python/">
    <meta name="twitter:label1" content="Written by">
    <meta name="twitter:data1" content="Shantnu Tiwari">
    <meta name="twitter:label2" content="Filed under">
    <meta name="twitter:data2" content="pfse-book">
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "Python for Engineers",
        "url": "https://new.pythonforengineers.com/",
        "logo": {
            "@type": "ImageObject",
            "url": "https://new.pythonforengineers.com/favicon.ico"
        }
    },
    "author": {
        "@type": "Person",
        "name": "Shantnu Tiwari",
        "image": {
            "@type": "ImageObject",
            "url": "https://new.pythonforengineers.com/content/images/2021/08/shantnu-foto-small-1.jpg"
        },
        "url": "https://new.pythonforengineers.com/author/shantnu/",
        "sameAs": []
    },
    "headline": "Audio and Digital Signal Processing(DSP) in Python",
    "url": "https://new.pythonforengineers.com/blog/audio-and-digital-signal-processingdsp-in-python/",
    "datePublished": "2021-08-17T14:03:23.000Z",
    "dateModified": "2021-08-17T14:03:23.000Z",
    "keywords": "pfse-book",
    "description": "Intro: Start here\n[https://new.pythonforengineers.com/blog/python-for-scientists-and-engineers/]\n\nBeginners Start Here:\n\nCreate a Word Counter in Python\n[https://new.pythonforengineers.com/blog/create-a-word-counter-in-python/]\n\nAn introduction to Numpy and Matplotlib\n[https://new.pythonforengineers.com/blog/an-introduction-to-numpy-and-matplotlib/]\n\nIntroduction to Pandas with Practical Examples (New)\n[https://new.pythonforengineers.com/blog/introduction-to-pandas/]\n\nMain Book\n\nImage and Video ",
    "mainEntityOfPage": "https://new.pythonforengineers.com/blog/audio-and-digital-signal-processingdsp-in-python/"
}
    </script>

    <meta name="generator" content="Ghost 5.129">
    <link rel="alternate" type="application/rss+xml" title="Python for Engineers" href="../rss/index.html">
        
    
    <link href="https://new.pythonforengineers.com/webmentions/receive/" rel="webmention">
    <script defer src="../../public/cards.min.js%3Fv=ddf1563274"></script>
    <link rel="stylesheet" type="text/css" href="../../public/cards.min.css%3Fv=ddf1563274.css">
    <script defer src="../../public/member-attribution.min.js%3Fv=ddf1563274"></script><style>:root {--ghost-accent-color: #FF1A75;}</style>
    <link rel="stylesheet" href="/assets/css/prism-okaidia.min.css" integrity="sha512-mIs9kKbaw6JZFfSuo+MovjU+Ntggfoj8RwAmJbVXQ5mkAX5LlgETQEweFPI18humSPHymTb5iikEOKWF7I8ncQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<link rel="stylesheet" href="/assets/css/prism-toolbar.min.css" />

</head>
<body class="post-template tag-pfse-book">
<div class="viewport">

    <header id="gh-head" class="gh-head ">
        <nav class="gh-head-inner inner gh-container">

            <div class="gh-head-brand">
                <a class="gh-head-logo" href="../../home/index.html">
                        Python for Engineers
                </a>
                <a class="gh-burger" role="button">
                    <div class="gh-burger-box">
                        <div class="gh-burger-inner"></div>
                    </div>
                </a>
            </div>
            <div class="gh-head-menu">
                <ul class="nav">
    <li class="nav-home"><a href="../../home/index.html">Home</a></li>
    <li class="nav-about-contact"><a href="../../about/index.html">About/Contact</a></li>
    <li class="nav-books"><a href="../../books.html">Books</a></li>
    <li class="nav-blog"><a href="../../author/Shantnu/index.html">Blog</a></li>
    <li class="nav-search"><a href="index.html#/search">Search</a></li>
</ul>

            </div>
            <div class="gh-head-actions">
                <div class="gh-social">
                </div>

                    <a class="gh-head-button" href="index.html#/portal/signup">Subscribe</a>
            </div>
        </nav>
    </header>

    <main>
        



<article class="article post tag-pfse-book no-image">

    <header class="article-header gh-canvas">

        <section class="article-tag">
            <a href="../../tag/pfse-book/index.html">pfse-book</a>
        </section>

        <h1 class="article-title">Audio and Digital Signal Processing(DSP) in Python</h1>


        <div class="article-byline">
            <section class="article-byline-content">
                <ul class="author-list">
                    <li class="author-list-item">
                        <a href="../../author/Shantnu/index.html" class="author-avatar">
                            <img class="author-profile-image" src="../../content/images/size/w100/2021/08/shantnu-foto-small-1.jpg" alt="Shantnu Tiwari" />
                        </a>
                    </li>
                </ul>
                <div class="article-byline-meta">
                    <h4 class="author-name"><a href="../../author/Shantnu/index.html">Shantnu Tiwari</a></h4>
                    <div class="byline-meta-content">
                        <time class="byline-meta-date" datetime="2021-08-17">Aug 17, 2021</time>
                        <span class="byline-reading-time"><span class="bull">&bull;</span> 15 min read</span>
                    </div>
                </div>
            </section>
        </div>

    </header>

    <section class="gh-content gh-canvas">
        <p><a href="../python-for-scientists-and-engineers/index.html"><strong>Intro: Start here</strong></a></p><p><strong>Beginners Start Here:</strong></p><p><a href="../create-a-word-counter-in-python/index.html"><strong>Create a Word Counter in Python</strong></a></p><p><a href="../an-introduction-to-numpy-and-matplotlib/index.html"><strong>An introduction to Numpy and Matplotlib</strong></a></p><p><a href="../introduction-to-pandas/index.html"><strong>Introduction to Pandas with Practical Examples (New)</strong></a></p><p><strong>Main Book</strong></p><p><a href="../image-and-video-processing-in-python/index.html"><strong>Image and Video Processing in Python</strong></a></p><p><a href="../data-analysis-with-pandas/index.html"><strong>Data Analysis with Pandas</strong></a></p><p><a href="index.html"><strong>Audio and Digital Signal Processing (DSP)</strong></a></p><p><strong>Machine Learning Section</strong></p><p><a href="../machine-learning-with-an-amazon-like-recommendation-engine/index.html"><strong>Machine Learning with an Amazon like Recommendation Engine</strong></a></p><!--kg-card-begin: markdown--><h2 id="create-a-sine-wave">Create a sine wave</h2>
<p>In this project, we are going to create a sine wave, and save it as a wav file.</p>
<p>But before that, some theory you should know.</p>
<p><strong>Frequency</strong>: The frequency is the number of times a sine wave repeats a second. I will use a frequency of 1KHz.</p>
<p><strong>Sampling rate</strong>: Most real world signals are analog, while computers are digital. So we need a analog to digital converter to convert our analog signal to digital. Details of how the converter work are beyond the scope of this book. The key thing is the sampling rate, which is the number of times a second the converter takes a sample of the analog signal.</p>
<p>Now, the sampling rate doesn’t really matter for us, as we are doing everything digitally, but it’s needed for our sine wave formula. I will use a value of 48000, which is the value used in professional audio equipment.</p>
<p><strong>Sine Wave formula</strong>: If you forgot the formula, don’t worry. I had to check Wikipedia as well.</p>
<pre><code class="language-python">y(t) = A * sin(2 * pi * f * t)
</code></pre>
<p><em>y(t)</em> is the y axis sample we want to calculate for x axis sample <em>t</em>.</p>
<p><em>A</em> is the amplitude. We’ll come to that.</p>
<p><em>pi</em> is our old friend 3.14159.</p>
<p><em>f</em> is the frequency.</p>
<p><em>t</em> is our sample. Since we need to convert it to digital, we will divide it by the sampling rate.</p>
<p><strong>Amplitude</strong></p>
<p>I mentioned the amplitude <em>A</em>. In most books, they just choose a random value for A, usually 1. But that won’t work for us. The sine wave we generate will be in floating point, and while that will be good enough for drawing a graph, it won’t work when we write to a file. The reason being that we are dealing with integers. If you look at wave files, they are written as 16 bit short integers. If we write a floating point number, it will not be represented right.</p>
<p>To get around this, we have to convert our floating point number to fixed point. One of the ways to do so is to multiply it with a fixed constant. How do we calculate this constant? Well, the maximum value of signed 16 bit number is 32767 (2^15 – 1). (Because the left most bit is reserved for the sign, leaving 15 bits. We raise 2 to the power of 15 and then subtract one, as computers count from 0).</p>
<p>So we want full scale audio, we’d multiply it with 32767. But I want an audio signal that is half as loud as full scale, so I will use an amplitude of 16000.</p>
<p>To the code:</p>
<pre><code class="language-python">import numpy as np

import wave

import struct

import matplotlib.pyplot as plt

# frequency is the number of times a wave repeats a second

frequency = 1000

num_samples = 48000

# The sampling rate of the analog to digital convert

sampling_rate = 48000.0

amplitude = 16000

file = &quot;test.wav&quot;
</code></pre>
<p>I just setup the variables I have declared.</p>
<pre><code class="language-python">sine_wave = [np.sin(2 * np.pi * frequency * x/sampling_rate) for x in range(num_samples)]
</code></pre>
<p>Half of you are going to quit the book right now. Go on, you want to. That’s one killer equation, isn’t it?</p>
<p>But if you remembered what I said, list comprehensions are the most powerful features of Python. I could have written the above as a normal for loop, but I wanted to show you the power of list comprehensions. The above code is quite simple if you understand it. Let’s break it down, shall we? It will be easier if you have the source code open as well.</p>
<p>The first thing is that the equation is in <em>[]</em>, which means the final answer will be converted to a list.</p>
<pre><code class="language-python">[ for x in range(num_samples)]
</code></pre>
<p>The <em>range()</em> function generates a list of numbers from 0 to <em>num_samples</em>. So we are saying loop over a variable <em>x</em> from 0 to 48000, the number of samples we have.</p>
<pre><code class="language-python">[np.sin(2 * np.pi * frequency * x/sampling_rate)]
</code></pre>
<p>This says that for each <em>x</em> that we generated, run it through the formula for the sine wave,</p>
<pre><code class="language-python">2 * pi * f * t.
</code></pre>
<p>So if we look at the code again:</p>
<pre><code class="language-python">sine_wave = [np.sin(2 * np.pi * frequency * x/sampling_rate) for x in range(num_samples)]
</code></pre>
<p>It says generate x in the range of 0 to num_samples, and for each of that <em>x</em> value, generate a value that is the sine of that. You can think of this value as the <em>y</em> axis values. All these values are then put in a list. Easy peasy.</p>
<pre><code class="language-python">nframes=num_samples

comptype=&quot;NONE&quot;

compname=&quot;not compressed&quot;

nchannels=1

sampwidth=2
</code></pre>
<p>Okay, now it’s time to write the sine wave to a file. We are going to use Python’s inbuilt wave library. Here we set the paramerters. <em>nframes</em> is the number of frames or samples.</p>
<p><em>comptype</em> and <em>compname</em> both signal the same thing: The data isn’t compressed. <em>nchannels</em> is the number of channels, which is 1. <em>sampwidth</em> is the sample width in bytes. As I mentioned earlier, wave files are usually 16 bits or 2 bytes per sample.</p>
<pre><code class="language-python">wav_file=wave.open(file, 'w')

wav_file.setparams((nchannels, sampwidth, int(sampling_rate), nframes, comptype, compname))
</code></pre>
<p>We open the file and set the parameters.</p>
<pre><code class="language-python">for s in sine_wave:
   wav_file.writeframes(struct.pack('h', int(s*amplitude)))
</code></pre>
<p>This might require some explanation. We are writing the sine_wave sample by sample. <em>writeframes</em> is the function that writes a sine wave. All that is simple. This might confuse you:</p>
<pre><code class="language-python">struct.pack('h', int(s*amplitude))
</code></pre>
<p>So let’s break it down into parts.</p>
<pre><code class="language-python">int(s*amplitude)
</code></pre>
<p><em>s</em> is the single sample of the sine_wave we are writing. I am multiplying it with the amplitude here (to convert to fixed point). We could have done it earlier, but I’m doing it here, as this is where it matters, when we are writing to a file.</p>
<p>Now,the data we have is just a list of numbers. If we write it to a file, it will not be readable by an audio player.</p>
<p>Struct is a Python library that takes our data and packs it as binary data. The <em>h</em> in the code means 16 bit number.</p>
<p>To understand what packing does, let’s look at an example in IPython.</p>
<pre><code class="language-python">In [1]: import numpy as np

In [2]: np.sin(0.5)

Out[2]: 0.47942553860420301

In [5]: 0.479*16000

Out[5]: 7664.0
</code></pre>
<p>I am using <em>0.5</em> as an example above.</p>
<p>So we take the sin of 0.5, and convert it to a fixed point number by multiplying it by 16000. Now if we were to write this to file, it would just write 7664 as a string, which would be wrong. Let’s look at what struct does:</p>
<pre><code class="language-python">In [6]: struct.pack('h', 7664)

Out[6]: 'xf0x1d'
</code></pre>
<p><em>x</em> means the number is a hexadecimal. As you can see, struct has turned our number 7664 into 2 hex values: 0xf0 and 0x1d.</p>
<p>Why 0xf0 0x1d? Well, if you convert 7664 to hex, you will get 0xf01d.</p>
<p>Why two values? Because we are using 16 bit values and our number can’t fit in one. So struct broke it into two numbers.</p>
<p>Since the numbers are now in hex, they can be read by other programs, including our audio players.</p>
<p>Coming back to our code:</p>
<pre><code class="language-python">for s in sine_wave:
   wav_file.writeframes(struct.pack('h', int(s*amplitude)))
</code></pre>
<p>This will take our sine wave samples and write it to our file, <em>test.wav</em>, packed as 16 bit audio.</p>
<p>Play the file in any audio player you have- Windows Media player, VLC etc. You should hear a very short tone.</p>
<p>Now, we need to check if the frequency of the tone is correct. I am going to use Audacity, a open source audio player with a ton of features. One of them is that we can find the frequency of audio files. Let’s open up Audacity.</p>
<p><img src="../../content/images/2021/08/audacity.jpg" alt="audacity" loading="lazy"></p>
<p>So we have a sine wave. Note that the wave goes as high as 0.5, while 1.0 is the maximum value. Remember we multiplied by 16000, which was half of 36767, which was full scale?</p>
<p>Now to find the frequency. Go to Edit-&gt; Select All (or press Ctrl A), then Analyse-&gt; Plot Spectrum.</p>
<p><img src="../../content/images/2021/08/audacity_spectrum.jpg" alt="audacity_spectrum" loading="lazy"></p>
<p>You can see that the peak is at around a 1000 Hz, which is how we created our wave file.</p>
<h2 id="calculate-the-frequency-of-a-sine-wave">Calculate the frequency of a sine wave</h2>
<p>I took one course in signal processing in my degree, and didn’t understand a thing. We were asked to derive a hundred equations, with no sense or logic. I found the subject boring and pedantic.</p>
<p>Which is why I wasn’t happy when I had to study it again for my Masters. But I was in luck.</p>
<p>This time, the teacher was a practising engineer. He ran his own company and taught part time. Unlike the university teachers, he actually knew what the equations were for.</p>
<p>He started us with the Discrete Fourier Transform (DFT). I had heard of the DFT, and had no idea what it did. I could derive the equation, though fat lot of good it did me.</p>
<p>But this teacher (I forgot his name, he was a Danish guy) showed us a noisy signal, and then took the DFT of it. He then showed the results in a graphical window. We clearly saw the original sine wave and the noise frequency, and I understood for the first time what a DFT does.</p>
<p><strong>Use the DFT to get frequencies</strong></p>
<p>To get the frequency of a sine wave, you need to get its Discrete Fourier Transform(DFT). Contrary to what every book written by Phd types may have told you, you don’t need to understand how to derive the transform. You just need to know how to use it.</p>
<p>In its simplest terms, the DFT takes a signal and calculates which frequencies are present in it. In more technical terms, the DFT converts a time domain signal to a frequency domain. What does that mean? Let’s look at our sine wave.</p>
<p><img src="../../content/images/2021/08/figure_1-1.png" alt="figure_1-1" loading="lazy"></p>
<p>The wave is changing with time. If this was an audio file, you could imagine the player moving right as the file plays.</p>
<p>In the frequency domain, you see the frequency part of the signal. This image is taken from later on in the chapter to show you what the frequency domain looks like:</p>
<p><img src="../../content/images/2021/08/noisy2.png" alt="noisy2" loading="lazy"></p>
<p>The signal will change if you add or remove frequencies, but will not change in time. For example, if you take a 1000 Hz audio tone and take its frequency, the frequency will remain the same no matter how long you look at it. But if you look at it in the time domain, you will see the signal moving.</p>
<p>The DFT was really slow to run on computers (back in the 70s), so the Fast Fourier Transform (FFT) was invented. The FFT is what is normally used nowadays.</p>
<p>The way it works is, you take a signal and run the FFT on it, and you get the frequency of the signal back.</p>
<p>If you have never used (or even heard of) a FFT, don’t worry. I’ll teach you how to start using it, and you can read more online if you want. Most tutorials or books won’t teach you much anyway. They’ll usually blat you with equations, without showing you what to do with them.</p>
<p>On to the code. Open up <em>get_freq.py</em>,</p>
<pre><code class="language-python">frame_rate = 48000.0

infile = &quot;test.wav&quot;

num_samples = 48000

wav_file = wave.open(infile, 'r')

data = wav_file.readframes(num_samples)

wav_file.close()
</code></pre>
<p>We are reading the wave file we generated in the last example. This code should be clear enough. The <em>wave readframes()</em> function reads all the audio frames from a wave file.</p>
<pre><code class="language-python">data = struct.unpack('{n}h'.format(n=num_samples), data)
</code></pre>
<p>Remember we had to pack the data to make it readable in binary format? Well, we do the opposite now. The first parameter to the function is a format string, which is the same thing you use when you do a <em>print()</em>. You are telling the unpacker to unpack <em>num_samples</em> 16 bit words (remember the <em>h</em> means 16 bits).</p>
<pre><code class="language-python">data = np.array(data)
</code></pre>
<p>We then convert the data to a numpy array.</p>
<pre><code class="language-python">data_fft = np.fft.fft(data)
</code></pre>
<p>We take the <em>fft</em> of the data. This will create an array with all the frequencies present in the signal.</p>
<p>Now, here’s the problem. The <em>fft</em> returns an array of complex numbers that doesn’t tell us anything. If I print out the first 8 values of the fft, I get:</p>
<pre><code class="language-python">In [3]: data_fft[:8]

Out[3]:

array([ 13.00000000 +0.j        ,   8.44107682 -4.55121351j,

6.24696630-11.98027552j,   4.09513760 -2.63009999j,

-0.87934285 +9.52378503j,   2.62608334 +3.58733642j,

4.89671762 -3.36196984j,  -1.26176048 +3.0234555j ])
</code></pre>
<p>If only there was a way to convert the complex numbers to real values we can use. Let’s try to remember our high school formulas for converting complex numbers to real…</p>
<p>Wait. Numpy can do that for us.</p>
<pre><code class="language-python"># This will give us the frequency we want

frequencies = np.abs(data_fft)
</code></pre>
<p>The <em>numpy abs()</em> function will take our complex signal and generate the real part of it.</p>
<p><strong>Side Detour</strong></p>
<p>A bit of a detour to explain how the FFT returns its results.</p>
<p>The FFT returns all possible frequencies in the signal. And the way it returns is that each index contains a frequency element. Say you store the FFT results in an array called <em>data_fft</em>. Then:</p>
<p><em>data_fft[1]</em> will contain frequency part of 1 Hz.</p>
<p><em>data_fft[2]</em> will contain frequency part of 2 Hz.</p>
<p>…</p>
<p><em>data_fft[8]</em> will contain frequency part of 8 Hz.</p>
<p>…</p>
<p><em>data_fft[1000]</em> will contain frequency part of 1000 Hz.</p>
<p>Now what if you have no 1Hz frequency in your signal? You will still get a value at <em>data_fft[1]</em>, but it will be minuscule. To give you an example, I will take the real fft of a 1000 Hz wave:</p>
<pre><code class="language-python">data_fft = np.fft.fft(sine_wave)

abs(data_fft[0])

Out[7]: 8.1289678326462086e-13

abs(data_fft[1])

Out[8]: 9.9475299243014428e-12

abs(data_fft[1000])

Out[11]: 24000.0
</code></pre>
<p>If you look at the absolute values for <em>data_fft[0]</em> or <em>data_fft[1]</em>, you will see they are tiny. The <em>e-12</em> at the end means they are raised to a power of -12, so something like <em>0.00000000000812</em> for <em>data_fft[0]</em>. But if you look at <em>data_fft[1000]</em>, the value is a hue <em>24000</em>. This can easily be plotted.</p>
<p>If we want to find the array element with the highest value, we can find it by:</p>
<pre><code class="language-python">print(&quot;The frequency is {} Hz&quot;.format(np.argmax(frequencies)))
</code></pre>
<p><em>np.argmax</em> will return the highest frequency in our signal, which it will then print. As we have seen manually, this is at a 1000Hz (or the value stored at <em>data_fft[1000]</em>). And now we can plot the data too.</p>
<pre><code class="language-python">plt.subplot(2,1,1)

plt.plot(data[:300])

plt.title(&quot;Original audio wave&quot;)

plt.subplot(2,1,2)

plt.plot(frequencies)

plt.title(&quot;Frequencies found&quot;)

plt.xlim(0,1200)

plt.show()
</code></pre>
<p>This should be known to you. The only new thing is the <em>subplot</em> function, which allows you to draw multiple plots on the same window.</p>
<p><em>subplot(2,1,1)</em> means that we are plotting a 2×1 grid. The 3rd number is the plot number, and the only one that will change. It will become clearer when you see the graph.</p>
<p><img src="../../content/images/2021/08/get_freq.png" alt="get_freq" loading="lazy"></p>
<p>And that’s it, folks. We took our audio file and calculated the frequency of it. Next, we will add noise to our plot and then try to clean it.</p>
<h2 id="cleaning-a-noisy-sine-wave">Cleaning a noisy sine wave</h2>
<p>In this example, I’ll recreate the same example my teacher showed me. We’ll generate a sine wave, add noise to it, and then filter the noise. Let’s start with the code.</p>
<pre><code class="language-python"># frequency is the number of times a wave repeats a second

frequency = 1000

noisy_freq = 50

num_samples = 48000

# The sampling rate of the analog to digital convert

sampling_rate = 48000.0
</code></pre>
<p>The main frequency is a 1000Hz, and we will add a noise of 50Hz to it.</p>
<pre><code class="language-python">#Create the sine wave and noise

sine_wave = [np.sin(2 * np.pi * frequency * x1 / sampling_rate) for x1 in range(num_samples)]

sine_noise = [np.sin(2 * np.pi * noisy_freq * x1/  sampling_rate) for x1 in range(num_samples)]

#Convert them to numpy arrays

sine_wave = np.array(sine_wave)

sine_noise = np.array(sine_noise)
</code></pre>
<p>I hope the above isn’t scary to you anymore, as it’s the same code as before. We generate two sine waves, one for the signal and one for the noise, and convert them to numpy arrays.</p>
<pre><code class="language-python"># Add them to create a noisy signal

combined_signal = sine_wave + sine_noise
</code></pre>
<p>I am adding the noise to the signal. As I mentioned earlier, this is possible only with numpy. With normal Python, you’d have to for loop or use list comprehensions. Messy. With numpy, you can add two arrays like they were normal numbers, and numpy takes care of the low level detail for you.</p>
<p>On to some graphing of what we have till now.</p>
<pre><code class="language-python">plt.subplot(3,1,1)

plt.title(&quot;Original sine wave&quot;)

# Need to add empty space, else everything looks scrunched up!

plt.subplots_adjust(hspace=.5)

plt.plot(sine_wave[:500])

plt.subplot(3,1,2)

plt.title(&quot;Noisy wave&quot;)

plt.plot(sine_noise[:4000])

plt.subplot(3,1,3)

plt.title(&quot;Original + Noise&quot;)

plt.plot(combined_signal[:3000])

plt.show()
</code></pre>
<p>Nothing shocking here.</p>
<p><img src="../../content/images/2021/08/noisy1.png" alt="noisy1" loading="lazy"></p>
<pre><code class="language-python">data_fft = np.fft.fft(combined_signal)

freq = (np.abs(data_fft[:len(data_fft)]))
</code></pre>
<p><em>data_fft</em> contains the fft of the combined noise+signal wave. <em>freq</em> contains the absolute of the frequencies found in it.</p>
<pre><code class="language-python">plt.plot(freq)

plt.title(&quot;Before filtering: Will have main signal (1000Hz) + noise frequency (50Hz)&quot;)

plt.xlim(0,1200)
</code></pre>
<p>We take the fft of the signal, as before, and plot it. This time, we get two signals: Our sine wave at 1000Hz and the noise at 50Hz.</p>
<p><img src="../../content/images/2021/08/noisy2-1.png" alt="noisy2-1" loading="lazy"></p>
<p>Now, to filter the signal. I won’t cover filtering in any detail, as that can take a whole book. Instead, I will create a simple filter just using the fft. The goal is to get you comfortable with Numpy.</p>
<p>First, here is the complete code:</p>
<pre><code class="language-python">for f in freq:
    # Filter between lower and upper limits
    # Choosing 950, as closest to 1000. In real world, won't get exact numbers like these
    if index &gt; 950 and index &lt; 1050:
        # Has a real value. I'm choosing &gt;1, as many values are like 0.000000001 etc
        if f &gt; 1:
            filtered_freq.append(f)

        else:
            filtered_freq.append(0)
    else:
        filtered_freq.append(0)
index += 1
</code></pre>
<p>Now let’s go over it line by line:</p>
<pre><code class="language-python">filtered_freq = []

index = 0

for f in freq:
</code></pre>
<p>We create an empty list called <em>filtered_freq</em>. If you remember, <em>freq</em> stores the absolute values of the fft, or the frequencies present.</p>
<pre><code class="language-python">if index &gt; 950 and index &lt; 1050:
</code></pre>
<p><em>index</em> is the current array element in the array <em>freq</em>. As I said, the <em>fft</em> returns all frequencies in the signal. These are stored in the array based on the index, so <em>freq[1]</em> will have the frequency of 1Hz, <em>freq[2]</em> will have 2Hz and so on.</p>
<p>Since I know my frequency is 1000Hz, I will search around that. In the real world, we will never get the exact frequency, as noise means some data will be lost. So I’m using a lower limit of 950 and upper limit of 1050. I check if the frequency we are looping is within this range.</p>
<pre><code class="language-python"> if f &gt; 1:

    filtered_freq.append(f)
</code></pre>
<p>I mentioned this earlier as well: While all frequencies will be present, their absolute values will be minuscule, usually less than 1. So if we find a value greater than 1, we save it to our <em>filtered_freq</em> array.</p>
<pre><code class="language-python">else:

   filtered_freq.append(0)

else:

   filtered_freq.append(0)

index += 1
</code></pre>
<p>If our frequency is not within the range we are looking for, or if the value is too low, we append a zero. This is to remove all frequencies we don’t want. And then we increment index.</p>
<p><strong>Update</strong></p>
<p><em>As reader <a href="https://gist.github.com/masasin?ref=new.pythonforengineers.com">Jean Nassar </a>pointed out, the whole code above can be<a href="https://gist.github.com/masasin/e81e51b5ba109b3f2812f7961b781d28?ref=new.pythonforengineers.com"> replaced by one line</a>.</em></p>
<p><em>So:</em></p>
<pre><code class="language-python">for f in freq:
    # Filter between lower and upper limits
    # Choosing 950, as closest to 1000. In real world, won't get exact numbers like these
    if index &gt; 950 and index &lt; 1050:
        # Has a real value. I'm choosing &gt;1, as many values are like 0.000000001 etc
        if f &gt; 1:
            filtered_freq.append(f)

        else:
            filtered_freq.append(0)
    else:
        filtered_freq.append(0)
index += 1
</code></pre>
<p><em>can be replaced by:</em></p>
<pre><code class="language-python">filtered_freq = [f if (950 &lt; index &lt; 1050 and f &gt; 1) else 0 for index, f in enumerate(freq)]
</code></pre>
<p><em>Now back to the book…</em></p>
<pre><code class="language-python">plt.plot(filtered_freq)

plt.title(&quot;After filtering: Main signal only (1000Hz)&quot;)

plt.xlim(0,1200)

plt.show()

plt.close()
</code></pre>
<p>And we plot what we have.</p>
<p><img src="../../content/images/2021/08/noisy3.png" alt="noisy3" loading="lazy"></p>
<pre><code class="language-python">recovered_signal = np.fft.ifft(filtered_freq)
</code></pre>
<p>Now we take the <em>ifft</em>, which stands for Inverse FFT. This will take our signal and convert it back to time domain. We can now compare it with our original noisy signal. We do that with graphing:</p>
<pre><code class="language-python">plt.subplot(3,1,1)

plt.title(&quot;Original sine wave&quot;)

# Need to add empty space, else everything looks scrunched up!

plt.subplots_adjust(hspace=.5)

plt.plot(sine_wave[:500])

plt.subplot(3,1,2)

plt.title(&quot;Noisy wave&quot;)

plt.plot(combined_signal[:4000])

plt.subplot(3,1,3)

plt.title(&quot;Sine wave after clean up&quot;)

plt.plot((recovered_signal[:500]))

plt.show()
</code></pre>
<p><img src="../../content/images/2021/08/noisy4.png" alt="noisy4" loading="lazy"></p>
<p>Note that we will receive a warning:</p>
<pre><code class="language-python">ComplexWarning: Casting complex values to real discards the imaginary part

return array(a, dtype, copy=False, order=order)
</code></pre>
<p>This is, again, because the <em>fft</em> returns an array of complex numbers. Luckily, like the warning says, the imaginary part will be discarded.</p>
<p>And there you go. Using our very simplistic filter, we have cleaned a sine wave. And this brings us to the end of this chapter.</p>
<!--kg-card-end: markdown-->
    </section>


</article>



<aside class="read-more-wrap">
    <div class="read-more inner">


                    
<article class="post-card post no-image ">


    <div class="post-card-content">

        <a class="post-card-content-link" href="../awesome-python-library-tenacity/index.html">
            <header class="post-card-header">
                <h2 class="post-card-title">Awesome Python Library: Tenacity</h2>
            </header>
            <section class="post-card-excerpt">
                <p>Link: https://tenacity.readthedocs.io/en/latest/

When writing code or tests in Python, one issue I had was when the code would fail due to random things like network issues or external peripherals not responding in time. Just rerunning the tests would make them pass. The unreliability wasn&#39;</p>
            </section>
        </a>

        <footer class="post-card-meta">
            <ul class="author-list">
                <li class="author-list-item">
                    <a href="../../author/Shantnu/index.html" class="static-avatar">
                        <img class="author-profile-image" src="../../content/images/size/w100/2021/08/shantnu-foto-small-1.jpg" alt="Shantnu Tiwari" />
                    </a>
                </li>
            </ul>
            <div class="post-card-byline-content">
                <span><a href="../../author/Shantnu/index.html">Shantnu Tiwari</a></span>
                <span class="post-card-byline-date"><time datetime="2024-04-10">Apr 10, 2024</time> <span class="bull">&bull;</span> 2 min read</span>
            </div>
        </footer>

    </div>

</article>
                    
<article class="post-card post no-image ">


    <div class="post-card-content">

        <a class="post-card-content-link" href="../so-evidently/index.html">
            <header class="post-card-header">
                <h2 class="post-card-title">So Google&#x27;s Gemini Doesn&#x27;t Like Python Programming and Sanskrit?</h2>
            </header>
            <section class="post-card-excerpt">
                <p>I have been playing around with Googles Gemini Pro.

Recently, I wanted to write a blog on Python&#39;s decorators and wanted to get some ideas for practical projects I could build with them. Tried GPT4 first, it gave me the standard &quot;log analyser&quot; that all blogs</p>
            </section>
        </a>

        <footer class="post-card-meta">
            <ul class="author-list">
                <li class="author-list-item">
                    <a href="../../author/Shantnu/index.html" class="static-avatar">
                        <img class="author-profile-image" src="../../content/images/size/w100/2021/08/shantnu-foto-small-1.jpg" alt="Shantnu Tiwari" />
                    </a>
                </li>
            </ul>
            <div class="post-card-byline-content">
                <span><a href="../../author/Shantnu/index.html">Shantnu Tiwari</a></span>
                <span class="post-card-byline-date"><time datetime="2024-02-25">Feb 25, 2024</time> <span class="bull">&bull;</span> 4 min read</span>
            </div>
        </footer>

    </div>

</article>
                    
<article class="post-card post ">

    <a class="post-card-image-link" href="../linkedin-has-become-a-piece-of-garbage-even-more-than-usual/index.html">
        <img class="post-card-image"
            srcset="../../content/images/size/w300/2024/01/ae223740-840b-4d4a-9467-2522a67dcbbc.png 300w,
                   ../../content/images/size/w600/2024/01/ae223740-840b-4d4a-9467-2522a67dcbbc.pngg 600w,
                  ../../content/images/size/w1000/2024/01/ae223740-840b-4d4a-9467-2522a67dcbbc.pngng 1000w,
                 ../../content/images/size/w2000/2024/01/ae223740-840b-4d4a-9467-2522a67dcbbc.pngpng 2000w"
            sizes="(max-width: 1000px) 400px, 800px"
            src="../../content/images/size/w600/2024/01/ae223740-840b-4d4a-9467-2522a67dcbbc.png"
            alt="LinkedIn Has Become a Pile of Garbage (even more than usual)"
            loading="lazy"
        />
    </a>

    <div class="post-card-content">

        <a class="post-card-content-link" href="../linkedin-has-become-a-piece-of-garbage-even-more-than-usual/index.html">
            <header class="post-card-header">
                <h2 class="post-card-title">LinkedIn Has Become a Pile of Garbage (even more than usual)</h2>
            </header>
            <section class="post-card-excerpt">
                <p>Online forums, especially Hacker News and Reddit, are very hostile to LinkedIn. Everyone makes fun of the self-promotion and silliness that goes there. There are complaints the site is unusable, which I didn&#39;t agree with until now.

I&#39;ve had an account there for a few years.</p>
            </section>
        </a>

        <footer class="post-card-meta">
            <ul class="author-list">
                <li class="author-list-item">
                    <a href="../../author/Shantnu/index.html" class="static-avatar">
                        <img class="author-profile-image" src="../../content/images/size/w100/2021/08/shantnu-foto-small-1.jpg" alt="Shantnu Tiwari" />
                    </a>
                </li>
            </ul>
            <div class="post-card-byline-content">
                <span><a href="../../author/Shantnu/index.html">Shantnu Tiwari</a></span>
                <span class="post-card-byline-date"><time datetime="2024-01-29">Jan 29, 2024</time> <span class="bull">&bull;</span> 4 min read</span>
            </div>
        </footer>

    </div>

</article>

    </div>
</aside>


    </main>

    <footer class="site-footer outer">
        <div class="inner">
            <section class="copyright"><a href="../../home/index.html">Python for Engineers</a> &copy; 2025</section>
            <nav class="site-footer-nav">
                
            </nav>
            

        </div>
    </footer>

</div>


<script
    src="/assets/js/jquery-3.5.1.min.js"
    integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
    crossorigin="anonymous">
</script>
<script src="../../assets/built/casper.js"></script>
<script>
$(document).ready(function () {
    // Mobile Menu Trigger
    $('.gh-burger').click(function () {
        $('body').toggleClass('gh-head-open');
    });
    // FitVids - Makes video embeds responsive
    $(".gh-content").fitVids();
});
</script>

<script src="/assets/js/prism.min.js" integrity="sha512-axJX7DJduStuBB8ePC8ryGzacZPr3rdLaIDZitiEgWWk2gsXxEFlm4UW0iNzj2h3wp5mOylgHAzBzM4nRSvTZA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>



<script src="/assets/js/prism-toolbar.min.js" integrity="sha512-YrvgEHAi5/3o2OT+/vh1z19oJXk/Kk0qdVKbjEFl9VRmcLTaWRYzVziZCvoGpJ2TrnV7rB8pnJcz1ioVJjgw2A==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

</body>
</html>
