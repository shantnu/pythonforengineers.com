<!DOCTYPE html>
<html lang="en">
<head>

    <title>Analysing the Enron Email Corpus</title>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" type="text/css" href="../../assets/built/screen.css" />

    <link rel="canonical" href="index.html">
    <meta name="referrer" content="no-referrer-when-downgrade">
    
    
    <meta property="og:site_name" content="Python for Engineers">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Analysing the Enron Email Corpus">
    <meta property="og:description" content="0. Introduction to NLP and Sentiment Analysis
[https://new.pythonforengineers.com/blog/natural-language-processing-and-sentiment-analysis-with-python/]

1. Natural Language Processing with NTLK
[https://new.pythonforengineers.com/blog/introduction-to-nltk-natural-language-processing-with-python/]

2. Intro to NTLK, Part 2
[https://new.pythonforengineers.com/blog/intro-to-nltk-part-2/]

3. Build a sentiment analysis program
[https://new.pythonforengineers.com/blog/build-a-sentiment-analysis-app-w">
    <meta property="og:url" content="https://new.pythonforengineers.com/blog/analysing-the-enron-email-corpus/">
    <meta property="article:published_time" content="2021-08-18T12:51:28.000Z">
    <meta property="article:modified_time" content="2021-08-18T12:53:01.000Z">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Analysing the Enron Email Corpus">
    <meta name="twitter:description" content="0. Introduction to NLP and Sentiment Analysis
[https://new.pythonforengineers.com/blog/natural-language-processing-and-sentiment-analysis-with-python/]

1. Natural Language Processing with NTLK
[https://new.pythonforengineers.com/blog/introduction-to-nltk-natural-language-processing-with-python/]

2. Intro to NTLK, Part 2
[https://new.pythonforengineers.com/blog/intro-to-nltk-part-2/]

3. Build a sentiment analysis program
[https://new.pythonforengineers.com/blog/build-a-sentiment-analysis-app-w">
    <meta name="twitter:url" content="https://new.pythonforengineers.com/blog/analysing-the-enron-email-corpus/">
    <meta name="twitter:label1" content="Written by">
    <meta name="twitter:data1" content="Shantnu Tiwari">
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "Python for Engineers",
        "url": "https://new.pythonforengineers.com/",
        "logo": {
            "@type": "ImageObject",
            "url": "https://new.pythonforengineers.com/favicon.ico"
        }
    },
    "author": {
        "@type": "Person",
        "name": "Shantnu Tiwari",
        "image": {
            "@type": "ImageObject",
            "url": "https://new.pythonforengineers.com/content/images/2021/08/shantnu-foto-small-1.jpg"
        },
        "url": "https://new.pythonforengineers.com/author/shantnu/",
        "sameAs": []
    },
    "headline": "Analysing the Enron Email Corpus",
    "url": "https://new.pythonforengineers.com/blog/analysing-the-enron-email-corpus/",
    "datePublished": "2021-08-18T12:51:28.000Z",
    "dateModified": "2021-08-18T12:53:01.000Z",
    "description": "0. Introduction to NLP and Sentiment Analysis\n[https://new.pythonforengineers.com/blog/natural-language-processing-and-sentiment-analysis-with-python/]\n\n1. Natural Language Processing with NTLK\n[https://new.pythonforengineers.com/blog/introduction-to-nltk-natural-language-processing-with-python/]\n\n2. Intro to NTLK, Part 2\n[https://new.pythonforengineers.com/blog/intro-to-nltk-part-2/]\n\n3. Build a sentiment analysis program\n[https://new.pythonforengineers.com/blog/build-a-sentiment-analysis-app-w",
    "mainEntityOfPage": "https://new.pythonforengineers.com/blog/analysing-the-enron-email-corpus/"
}
    </script>

    <meta name="generator" content="Ghost 5.129">
    <link rel="alternate" type="application/rss+xml" title="Python for Engineers" href="../rss/index.html">
        
    
    <link href="https://new.pythonforengineers.com/webmentions/receive/" rel="webmention">
    <script defer src="../../public/cards.min.js%3Fv=ddf1563274"></script>
    <link rel="stylesheet" type="text/css" href="../../public/cards.min.css%3Fv=ddf1563274.css">
    <script defer src="../../public/member-attribution.min.js%3Fv=ddf1563274"></script><style>:root {--ghost-accent-color: #FF1A75;}</style>
    <link rel="stylesheet" href="/assets/css/prism-okaidia.min.css" integrity="sha512-mIs9kKbaw6JZFfSuo+MovjU+Ntggfoj8RwAmJbVXQ5mkAX5LlgETQEweFPI18humSPHymTb5iikEOKWF7I8ncQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<link rel="stylesheet" href="/assets/css/prism-toolbar.min.css" />

</head>
<body class="post-template">
<div class="viewport">

    <header id="gh-head" class="gh-head ">
        <nav class="gh-head-inner inner gh-container">

            <div class="gh-head-brand">
                <a class="gh-head-logo" href="../../home/index.html">
                        Python for Engineers
                </a>
                <a class="gh-burger" role="button">
                    <div class="gh-burger-box">
                        <div class="gh-burger-inner"></div>
                    </div>
                </a>
            </div>
            <div class="gh-head-menu">
                <ul class="nav">
    <li class="nav-home"><a href="../../home/index.html">Home</a></li>
    <li class="nav-about-contact"><a href="../../about/index.html">About/Contact</a></li>
    <li class="nav-books"><a href="../../books.html">Books</a></li>
    <li class="nav-blog"><a href="../../author/Shantnu/index.html">Blog</a></li>
    <li class="nav-search"><a href="index.html#/search">Search</a></li>
</ul>

            </div>
            <div class="gh-head-actions">
                <div class="gh-social">
                </div>

                    <a class="gh-head-button" href="index.html#/portal/signup">Subscribe</a>
            </div>
        </nav>
    </header>

    <main>
        



<article class="article post no-image">

    <header class="article-header gh-canvas">


        <h1 class="article-title">Analysing the Enron Email Corpus</h1>


        <div class="article-byline">
            <section class="article-byline-content">
                <ul class="author-list">
                    <li class="author-list-item">
                        <a href="../../author/Shantnu/index.html" class="author-avatar">
                            <img class="author-profile-image" src="../../content/images/size/w100/2021/08/shantnu-foto-small-1.jpg" alt="Shantnu Tiwari" />
                        </a>
                    </li>
                </ul>
                <div class="article-byline-meta">
                    <h4 class="author-name"><a href="../../author/Shantnu/index.html">Shantnu Tiwari</a></h4>
                    <div class="byline-meta-content">
                        <time class="byline-meta-date" datetime="2021-08-18">Aug 18, 2021</time>
                        <span class="byline-reading-time"><span class="bull">&bull;</span> 12 min read</span>
                    </div>
                </div>
            </section>
        </div>

    </header>

    <section class="gh-content gh-canvas">
        <p><a href="../natural-language-processing-and-sentiment-analysis-with-python/index.html"><strong>0. Introduction to NLP and Sentiment Analysis</strong></a></p><p><strong><a href="../introduction-to-nltk-natural-language-processing-with-python/index.html">1. Natural Language Processing with NTLK</a></strong></p><p><strong><a href="../intro-to-nltk-part-2/index.html">2. Intro to NTLK, Part 2</a></strong></p><p><a href="../build-a-sentiment-analysis-app-with-movie-reviews/index.html"><strong>3. Build a sentiment analysis program</strong></a></p><p><strong><a href="../practice-session-sentiment-analysis-with-twitter/index.html">4. Sentiment Analysis with Twitter</a></strong></p><p><strong><a href="index.html">5. Analysing the Enron Email Corpus</a></strong></p><p><a href="../build-a-spam-filter/index.html"><strong>6. Build a Spam Filter using the Enron Corpus</strong></a></p><hr><!--kg-card-begin: markdown--><p><em>1st the videos, transcript is below</em></p>
<!--kg-card-end: markdown--><p></p><p></p><figure class="kg-card kg-embed-card"><iframe src="https://player.vimeo.com/video/151171516?app_id=122963&amp;h=68ce185e6a" width="640" height="360" frameborder="0" allow="autoplay; fullscreen; picture-in-picture" allowfullscreen title="Enron1"></iframe></figure><figure class="kg-card kg-embed-card"><iframe src="https://player.vimeo.com/video/151171515?app_id=122963&amp;h=9f7e95ee3b" width="640" height="360" frameborder="0" allow="autoplay; fullscreen; picture-in-picture" allowfullscreen title="Enron2"></iframe></figure><figure class="kg-card kg-embed-card"><iframe src="https://player.vimeo.com/video/151171512?app_id=122963&amp;h=bdf132de8b" width="640" height="360" frameborder="0" allow="autoplay; fullscreen; picture-in-picture" allowfullscreen title="Enron3"></iframe></figure><figure class="kg-card kg-embed-card"><iframe src="https://player.vimeo.com/video/151171513?app_id=122963&amp;h=c4b8a50f0f" width="640" height="360" frameborder="0" allow="autoplay; fullscreen; picture-in-picture" allowfullscreen title="Enron4"></iframe></figure><figure class="kg-card kg-embed-card"><iframe src="https://player.vimeo.com/video/151257636?app_id=122963&amp;h=ea18855082" width="640" height="360" frameborder="0" allow="autoplay; fullscreen; picture-in-picture" allowfullscreen title="Enron5"></iframe></figure><figure class="kg-card kg-embed-card"><iframe src="https://player.vimeo.com/video/151257635?app_id=122963&amp;h=8b59b65286" width="640" height="360" frameborder="0" allow="autoplay; fullscreen; picture-in-picture" allowfullscreen title="Enron6"></iframe></figure><!--kg-card-begin: markdown--><p>The Enron Email Corpus is one of the biggest email data sources in the world. Almost half a million files spread over 2.5 GB. Normally, emails are very sensitive, and rarely released to the public, but because of the shocking nature of Enron’s collapse, everything was released to the public.</p>
<p>Because it is so large, it makes analysis complicated. The question always is: <em>Where do we even start?</em></p>
<p>In this first video, I given an introduction to Enron, and the email corpus.  Since the collapse was only 15 years ago(its 2016 now), I guess every reading this has heard of Enron, a company that was the top biggest company in the world one day, and bankrupt the next.</p>
<p>Download the emails from <a href="https://www.cs.cmu.edu/~./enron/?ref=new.pythonforengineers.com">here</a>. On Windows, you’ll need <a href="https://www.7-zip.org/?ref=new.pythonforengineers.com">7zip </a>to unzip them.</p>
<p>Once you download the files, spend some time looking at their structure, and how they are arranged. You will find the actual emails are in <a href="https://en.wikipedia.org/wiki/MIME?ref=new.pythonforengineers.com">MIME </a>format.</p>
<p>We won’t be using Ipython in this example, as it kept crashing (&amp; sometimes taking down Firefox). I guess it couldn’t handle the Gigabytes of data we have to work with.</p>
<p>You will need a code editor. I recommend VS Code.</p>
<p>For running the scripts, you will need to use the command line. On Windows, I recommend Powershell, a super charged version of the old dos prompt. Linux/Mac can stick to their default terminals.</p>
<p>Let’s get started. The dataset is huge, so we will go step by step. As the old joke goes, how do you eat an elephant?</p>
<blockquote>
<p><em>One bite at a time!</em></p>
</blockquote>
<p>We will take mini steps. Some of these might seem easy, but still follow them, as they will combine into the final whole.</p>
<h2 id="loop-through-all-the-files-in-the-dataset">Loop through all the files in the dataset</h2>
<p>All the code is <a href="https://github.com/shantnu/Enron-Data-Set?ref=new.pythonforengineers.com">here</a>. The file is <em>Enron1.py</em></p>
<p>To start off, we will see how to loop through all the files and folders in the email set.</p>
<p>We import the <em>os</em> library:</p>
<pre><code class="language-python">import os
</code></pre>
<p>In the next step, we need to provide a link to where the Enron emails are:</p>
<pre><code class="language-python">rootdir = &quot;C:\\Users\\Shantnu\\Desktop\\Data Sources\\maildir\\lay-k&quot;
</code></pre>
<p><strong>Warning for Windows Users:</strong> Make sure you replace the slash (<em>*) with a double slash (</em>\*).</p>
<p>Also note that we are starting in the <em>lay-k</em> directory. These are the emails for<a href="https://en.wikipedia.org/wiki/Kenneth_Lay?ref=new.pythonforengineers.com"> Kenneth Lay</a>, one time CEO and director, who went to prison. We are doing it this way to speed up our code, as otherwise it may take a long time to run.</p>
<p>We next use the <em>os.walk()</em> function to loop over the directories:</p>
<pre><code class="language-python">for directory, subdirectory, filenames in  os.walk(rootdir):
    print(directory, subdirectory, len(filenames))

C:\Users\Shantnu\Desktop\Data Sources\maildir\lay-k ['all_documents', 'business', 'calendar', 'compaq', 'deleted_items',
 'discussion_threads', 'elizabeth', 'enron', 'family', 'inbox', 'notes_inbox', 'sec_panel', 'sent', 'sent_items', '_sent
'] 0
C:\Users\Shantnu\Desktop\Data Sources\maildir\lay-k\all_documents [] 1127
C:\Users\Shantnu\Desktop\Data Sources\maildir\lay-k\business [] 2
C:\Users\Shantnu\Desktop\Data Sources\maildir\lay-k\calendar [] 8
C:\Users\Shantnu\Desktop\Data Sources\maildir\lay-k\compaq [] 1
C:\Users\Shantnu\Desktop\Data Sources\maildir\lay-k\deleted_items [] 1126
</code></pre>
<p>This will print the directory, sub directory and length of files (I’m not printing the actual files, as that messes the output, but the <em>os.walk</em> function actually returns each file it finds).</p>
<p>This is it for the first example. It was very short, but it shows us how we can loop over all the files in the email set. Now, change the root directory, so that instead of pointing to the <em>kay-l</em> folder, it points to the main one, and run the code again.</p>
<p>You will see it takes a fair time to run. If just printing the directories and files takes so long, how long would analysing them take?</p>
<p>Next, we learn how to open the emails.</p>
<h2 id="opening-the-emails-in-python">Opening the Emails in Python</h2>
<p>We work with <em>enron2.py</em>.</p>
<p>Go to the <em>lay-k</em> folder, then <em>all_documents</em>, and open file <em>1</em>.</p>
<p>Have a look at the Mime structure.</p>
<p>Originally, I was going to parse the file by hand (using regexes). I even wrote some code for it, but it was hundreds of lines long.</p>
<p>I searched around till I found a good library to open emails in Python, and this reduced the code from hundreds to tens of lines.</p>
<pre><code class="language-python">from email.parser import Parser
</code></pre>
<p>The <em>email.parser</em> is the library we want.</p>
<pre><code class="language-python">file_to_read = &quot;C:\\Users\\Shantnu\\Desktop\\Data Sources\\maildir\\lay-k\\all_documents\\1&quot;
</code></pre>
<p>Again, put a link to the file you want to read. Windows users, remember to use double slashes. This is the same file you viewed earlier. Let’s open the file:</p>
<pre><code class="language-python">with open(file_to_read, &quot;r&quot;) as f:
    data = f.read()
</code></pre>
<p>We now create an email parser instance:</p>
<pre><code class="language-python">email = Parser().parsestr(data)
</code></pre>
<p>Once that is done, getting the <em>to</em>, <em>from</em>, <em>subject</em> etc fields is fairly easy.</p>
<pre><code class="language-python">print(&quot;\nTo: &quot; , email['to'])
print(&quot;\n From: &quot; , email['from'])

print(&quot;\n Subject: &quot; , email['subject'])


To:  mmilken@knowledgeu.com

 From:  rosalee.fleming@enron.com

 Subject:  Re: testing
</code></pre>
<p>The only thing slightly confusing is how to get the body. You need to call a function for that:</p>
<pre><code class="language-python">print(&quot;\n \n Body: &quot; , email.get_payload())

 Body:  Hi -

We did receive the e-mail.

Rosalee for Ken Lay





&quot;Michael Milken&quot; &lt;mmilken@knowledgeu.com&gt; on 07/02/99 10:21:40 AM
To: Kenneth Lay/Corp/Enron@Enron
cc:
Subject: testing
</code></pre>
<p>Okay, now that we know how to loop over every single file in the dataset, and open emails, let’s combine the two. We will see who sent and received the most emails. We will also do some basic text analysis of Kenneth Lays emails.</p>
<h2 id="analyse-the-emails">Analyse the Emails</h2>
<!-- <iframe allowfullscreen="allowfullscreen" frameborder="0" height="450" mozallowfullscreen="mozallowfullscreen" src="https://player.vimeo.com/video/151171513?title=0&amp;byline=0&amp;portrait=0" webkitallowfullscreen="webkitallowfullscreen" width="800"></iframe> -->
<p>The file is <em>Enron3.py</em>.</p>
<pre><code class="language-python">import os
from email.parser import Parser
rootdir = &quot;C:\\Users\\Shantnu\\Desktop\\Data Sources\\maildir\\lay-k\\family&quot;
</code></pre>
<p>We import what we need. This time, we are working in the <em>lay-k\family</em> folder, as it contains the fewest files, and will allow us to run our script quickly.</p>
<p>I have written a function to extract the data from the emails. Let’s look at the whole function, and then we’ll study it line by line:</p>
<pre><code class="language-python">def email_analyse(inputfile, to_email_list, from_email_list, email_body):
    with open(inputfile, &quot;r&quot;) as f:
        data = f.read()

    email = Parser().parsestr(data)

    to_email_list.append(email['to'])
    from_email_list.append(email['from'])

    email_body.append(email.get_payload())
</code></pre>
<p>Okay, so the function is:</p>
<pre><code class="language-python">def email_analyse(inputfile, to_email_list, from_email_list, email_body):
</code></pre>
<p><em>email_analyse()</em> takes in 4 parameters: the input email file, a list of all <em>To</em> emails, a list for <em>From</em> emails, and a list that contains the body(text) of the email.</p>
<p>The first thing to do is open the file, and parse the email with our parser:</p>
<pre><code class="language-python">    with open(inputfile, &quot;r&quot;) as f:
        data = f.read()

    email = Parser().parsestr(data)
</code></pre>
<p>Now that we have created our email instance, we can read the different fields and store them in the lists:</p>
<pre><code class="language-python">    to_email_list.append(email['to'])
    from_email_list.append(email['from'])

    email_body.append(email.get_payload())
</code></pre>
<p>We append the 3 fields to their respective lists. So that the <em>email[‘to’]</em> is appended to the <em>to_email_list</em>.</p>
<p>These lists are passed in, which means that they will be modified and returned. So that each time you call this function, it will add to the list, and the list will grow each time the function is called.</p>
<p>Now we come to the main code:</p>
<pre><code class="language-python">to_email_list = []
from_email_list = []
email_body = []
</code></pre>
<p>We create the 3 empty lists that will be passed to our function.</p>
<p>Next, we call the <em>os.walk()</em> function we saw earlier:</p>
<pre><code class="language-python">for directory, subdirectory, filenames in  os.walk(rootdir):
    for filename in filenames:
        email_analyse(os.path.join(directory, filename), to_email_list, from_email_list, email_body )
</code></pre>
<p>The code is fairly easy. We just loop over all the directories and files, and call our <em>email_analyse</em> function each time. The part you might not get is:</p>
<pre><code class="language-python">os.path.join(directory, filename)
</code></pre>
<p>We are doing it this way, because we want the complete path to the file. Normally, <em>filename</em> will just contain the name, like <em>1</em>, <em>2</em> etc. But for our <em>open()</em> function, we need the whole path.</p>
<p>So the way the code works is, it loops over every single file in the directory and opens it, extracts the 3 fields we want, and returns them in the list. So far, so easy.</p>
<p>There is a problem with the code.</p>
<p>To show you why, we will write our lists to file:</p>
<pre><code class="language-python">with open(&quot;to_email_list.txt&quot;, &quot;w&quot;) as f:
    for to_email in to_email_list:
        if to_email:
            f.write(to_email)
            f.write(&quot;\n&quot;)
</code></pre>
<p>We loop over the <em>to_email_list</em>, and write each element to file. Some of these elements maybe <em>None</em> due to parsing problems, or corrupt emails, which is why we check this:</p>
<pre><code class="language-python">if to_email:
</code></pre>
<p>I am writing a newline (<em>\n</em>) after each email, so that each email is written to a separate line in the file.</p>
<p>Similarly for the other lists:</p>
<pre><code class="language-python">with open(&quot;from_email_list.txt&quot;, &quot;w&quot;) as f:
    for from_email in from_email_list:
        if from_email:
            f.write(from_email)
            f.write(&quot;\n&quot;)

with open(&quot;email_body.txt&quot;, &quot;w&quot;) as f:
    for email_bod in email_body:
        if email_bod:
            f.write(email_bod)
            f.write(&quot;\n&quot;)
</code></pre>
<p>Let’s see the files we created. Ignore the body text email for now. Let’s open <em>from_email_.txt</em>:</p>
<pre><code class="language-python">beau@rrhinvestments.com
beau@rrhinvestments.com
mrslinda@lplpi.com
mrslinda@lplpi.com
mrslinda@lplpi.com
nlay@att.net
nlay@att.net
sally.keepers@enron.com
</code></pre>
<p>That is correct. One email per line.</p>
<p>Let’s open the <em>to_email.txt</em>:</p>
<pre><code class="language-python">kenneth.lay@enron.com
kenneth.lay@enron.com
kenneth.lay@enron.com
klay@enron.com, poppopindc@aol.com, dherrold@enlineresources.com,
    nlay@worldnet.att.net, lizard_ar@yahoo.com,
    marlenen@rowefurniture.com, aka@zdimensional.com,
    rnegri@mindspring.com, bourneb@umsystem.edu, sharon@travelpark.com,
    jessi020674@aol.com, jimemerson@hotmail.com,


......... snipped ...................
</code></pre>
<p>The first three lines are correct, but in the fourth one, there are a dozen emails in one line. Our code didn’t work. Why not?</p>
<p>In the <em>lay-k/family</em> folder, open up the file <em>4</em>.</p>
<p><img src="https://new.pythonforengineers.com/blog/analysing-the-enron-email-corpus/%7Battach%7Denron1.png" alt="enron1" loading="lazy"><br>
<em>enron1</em></p>
<p>You will see that the <em>To</em> field contains dozens of email addresses. When we parse that file, all those email addresses are written as one entry in the list, when each should be added separately.</p>
<h2 id="fixing-our-code">Fixing our Code</h2>
<!-- <iframe allowfullscreen="allowfullscreen" frameborder="0" height="450" mozallowfullscreen="mozallowfullscreen" src="https://player.vimeo.com/video/151257636?title=0&amp;byline=0&amp;portrait=0" webkitallowfullscreen="webkitallowfullscreen" width="800"></iframe> -->
<p>Files: <em>Enron4.py</em> and <em>Enron5.py</em>. The latter is a version of the former that works on the whole dataset, and so has the write to file code removed, to prevent the script taking days to finish.</p>
<p>The video goes into detail on how and why I made the choices I did. In the transcript, I will only give the final version of the code.</p>
<p>Most of the code is similar to the last example, so I will only show the new code.</p>
<p>In the function <em>email_analyse</em>, we add this code:</p>
<pre><code class="language-python">if email['to']:
        email_to = email['to']
        email_to = email_to.replace(&quot;\n&quot;, &quot;&quot;)
        email_to = email_to.replace(&quot;\t&quot;, &quot;&quot;)
        email_to = email_to.replace(&quot; &quot;, &quot;&quot;)
</code></pre>
<p>Like I said earlier, some of the fields are empty (due to data corruption, old Mime formats that can’t be parsed, we don’t know). So we check if the <em>email[‘to’]</em> field exists.</p>
<p>If it does, we remove all the newline characters (<em>\n</em>), all the tabs (<em>\t</em>) and empty spaces. This is to ensure the code is parsed correctly. So after our replacing, something like:</p>
<pre><code class="language-python">klay@enron.com, poppopindc@aol.com, dherrold@enlineresources.com,
    nlay@worldnet.att.net, lizard_ar@yahoo.com,
    marlenen@rowefurniture.com, aka@zdimensional.com,
</code></pre>
<p>will become</p>
<pre><code class="language-python">klay@enron.com,poppopindc@aol.com,dherrold@enlineresources.com,nlay@worldnet.att.net,lizard_ar@yahoo.com,marlenen@rowefurniture.com,aka@zdimensional.com,
</code></pre>
<p>All special characters are gone. We can now extract all the individual emails:</p>
<pre><code class="language-python">email_to = email_to.split(&quot;,&quot;)
</code></pre>
<p>This will return a list with all the emails in the file (as the emails are separated by a comma). Note that if the file only had one email, the code will still work, as it will return a list with just one element.</p>
<p>We now loop over the list and append it to the <em>to_email_list</em>:</p>
<pre><code class="language-python">for email_to_1 in email_to:
            to_email_list.append(email_to_1)
</code></pre>
<p>The rest of the function is the same.</p>
<p>In the main code, we remove the code to write to a file, as we don’t need it. Instead, we want to count the emails, to find out who the top 10 most popular addresses are.</p>
<p>We will use the <em>Counter</em> library for this.</p>
<pre><code class="language-python">print(Counter(to_email_list).most_common(10))
</code></pre>
<p>We convert the <em>to_email_list</em> to Counter object. This will count all the unique emails in the list. When then call the <em>most_common()</em> function to get the ten most common emails.</p>
<p>The final code is:</p>
<pre><code class="language-python">print(&quot;\nTo email adresses: \n&quot;)
print(Counter(to_email_list).most_common(10))

print(&quot;\nFrom email adresses: \n&quot;)
print(Counter(from_email_list).most_common(10))
</code></pre>
<p>Remember, we are still in the lay-k (or Kenneth Lay’s) folder. The result is:</p>
<pre><code class="language-python">To email adresses:

[('kenneth.lay@enron.com', 2039), ('klay@enron.com', 1903), ('jeff.skilling@enron.com', 372), ('mark.koenig@enron.com',
313), ('mark.frevert@enron.com', 304), ('greg.whalley@enron.com', 304), ('steven.kean@enron.com', 278), ('mike.mcconnell
@enron.com', 261), ('jeffrey.mcmahon@enron.com', 251), ('john.sherriff@enron.com', 244)]

From email adresses:

[('rosalee.fleming@enron.com', 856), ('brown_mary_jo@lilly.com', 82), ('leonardo.pacheco@enron.com', 78), ('savont@email
.msn.com', 66), ('tori.wells@enron.com', 58), ('elizabeth.davis@compaq.com', 50), ('no.address@enron.com', 47), ('kather
ine.brown@enron.com', 47), ('mrslinda@lplpi.com', 40), ('lizard_ar@yahoo.com', 36)]
</code></pre>
<p>Most of the emails were sent with Lay’s own email address (as we are looking at his data). It seemed he had two email addreses: <em><a href="mailto:kenneth.lay@enron.com">kenneth.lay@enron.com</a></em> and <em><a href="mailto:klay@enron.com">klay@enron.com</a></em></p>
<p>The most emails he received were from Rosalee Fleming.</p>
<p>If you look at Enron5.py, it’s the same file, but the root directory is the whole email set. This means it will take longer to run. I have removed the write to file functions, as otherwise the code takes a whole day or two to run. If you run this file, it will find the most common to and from  emails in the whole company.</p>
<p>This is the result:</p>
<pre><code class="language-python">To:
[('richard.shapiro@enron.com', 15149), ('jeff.dasovich@enron.com', 14207), ('tana.jones@enron.com', 12828), ('steven.kea
n@enron.com', 12754), ('sara.shackleton@enron.com', 11433), ('james.steffes@enron.com', 10347), ('mark.taylor@enron.com'
, 9787), ('pete.davis@enron.com', 9281), ('susan.mara@enron.com', 9064), ('paul.kaufman@enron.com', 8522)]



From:
[('kay.mann@enron.com', 16735), ('vince.kaminski@enron.com', 14368), ('jeff.dasovich@enron.com', 11411), ('pete.davis@en
ron.com', 9149), ('chris.germany@enron.com', 8801), ('sara.shackleton@enron.com', 8777), ('enron.announcements@enron.com
', 8587), ('tana.jones@enron.com', 8490), ('steven.kean@enron.com', 6759), ('kate.symes@enron.com', 5438)]
</code></pre>
<p>You can Google these people to know who they were. In the <em>To</em> list, the top person is Richard Shapiro. He was the Vice President and lobbyist (“bribery guy”) for Enron. A lot of his emails are about handing dollars to politicians, and getting favourable laws passed. The fact that he received the most emails shows he was in touch with everything that was happening.</p>
<p>The highest <em>From</em> field, which is emails received from, is Kay Mann, who was the head of legal for Enron. The fact that she sent so many emails is ironical, seeing as how Enron was breaking every law in the book (keep in mind that most employees, including Kay Mann, were innocent. Only the top executives were guilty, and most went to prison).</p>
<p>But I still found this fact very funny. A company with such a active legal department, and yet the executives ignored (or didn’t care) about the law at all.</p>
<p>Right, to the final analysis.</p>
<h2 id="most-common-words-in-kenneth-lay%E2%80%99s-emails">Most Common Words in Kenneth Lay’s emails</h2>
<!-- <iframe allowfullscreen="allowfullscreen" frameborder="0" height="450" mozallowfullscreen="mozallowfullscreen" src="https://player.vimeo.com/video/151257635?title=0&amp;byline=0&amp;portrait=0" webkitallowfullscreen="webkitallowfullscreen" width="800"></iframe> -->
<p>Make sure you’ve done the NLTK intro (and its part 2) before tackling this.</p>
<p>If you remember, we wrote all of K Lay’s emails to a file. Let’s see if we can analyse that.</p>
<p>I’ve renamed the file <em>email_body.txt</em> to <em>ken_lay_emails.txt</em>.</p>
<pre><code class="language-python">import nltk
from nltk.tokenize import word_tokenize
from nltk.corpus import stopwords
</code></pre>
<p>We import our nltk libraries.</p>
<pre><code class="language-python">with open(&quot;ken_lay_emails.txt&quot;, &quot;r&quot;) as f:
    data = f.read()
</code></pre>
<p>We read the file.</p>
<pre><code class="language-python">words= word_tokenize(data)

useful_words = [word  for word in words if word not in stopwords.words('English')]
</code></pre>
<p>Next we tokenize it, and remove all the stop words.</p>
<p>Finally, we find the frequency of words:</p>
<pre><code class="language-python">frequency = nltk.FreqDist(useful_words)

print(frequency.most_common(100))
</code></pre>
<pre><code class="language-python">[(',', 82443), ('.', 59781), ('--', 27631), ('?', 26239), ('&gt;', 22136), (':', 21640),
('@', 20084), ('Enron', 14536), ('I', 13970), (&quot;'s&quot;, 10955), (&quot;''&quot;, 10811),
(')', 10030), ('(', 9479), ('&lt;', 7817), ('-', 7340), ('The', 7138), (';', 5981),
('company', 5943), ('``', 5721), ('employees', 5234), ('$', 4969), ('energy', 4437),
('To', 4020), ('made', 3994), ('=20', 3921), ('would', 3843), ('California', 3734),
 ('Lay', 3468), ('consumers', 3441), ('Ken', 3402), ('http', 3213), ('Please', 3200),
('We', 3051), ('&amp;', 3048), ('million', 2866), ('!', 2678), ('stock', 2670), ('Mr.', 2621), ('pay', 2491), ('...', 2444)
, ('funds', 2393), ('retirement', 2329), ('bills', 2298), ('bankruptcy', 2297), ('millions', 2294),
 ('donate', 2260), ('declared', 2250), (&quot;n't&quot;, 2217), ('year', 2201), ('As', 2199), ('New', 2190), ('ENRON', 2182), ('help', 2154),
 ('information', 2095), ('know', 2086), ('last', 2060), ('time', 2039), ('*', 2036), ('well', 1998), ('If', 1933), ('us', 1911),
('many', 1899), (&quot;'&quot;, 1879), ('please', 1869), ('new', 1821), ('provide', 1818), ('This', 1789), ('Subject', 1783), ('2000', 1763), ('like', 1749),
 ('business', 1706), ('meeting', 1701), ('%', 1678), ('Houston', 1658), ('York', 1558), ('2001', 1544), ('keep', 1521), ('=', 1521), ('ECT', 1519),
 (&quot;'m&quot;, 1517), ('also', 1516), ('efforts', 1504), ('And', 1488), ('In', 1475), ('one', 1458), ('enron.com', 1449), ('money', 1426), ('state', 1423),
 ('set', 1422), ('Sincerely', 1398), ('call', 1385), ('100', 1373), ('October', 1363), ('result', 1362), ('largest', 1354), ('may', 1353),
('plans', 1352), ('Times', 1351), ('A', 1297), ('Communications', 1294)]
</code></pre>
<p>Some words like <em>communication</em> and <em>energy</em> are expected, as that’s what Enron did.</p>
<p>But I kept seeing <em>million</em>, <em>millions</em> and interestingly, <strong>bankruptcy</strong>.</p>
<p>The word California was mentioned 3734 times. The company had some (bad, I think) history there.</p>
<p>Finally, the word <em>meeting</em> was mentioned 1700 times. K Lay sure was a busy man.</p>
<p>And that’s it. This was a quick intro to the Enron corpus.</p>
<p>While doing this analysis, I was struck by how long it took to analyse the whole thing. Combining all the words in all the emails took a whole day for me (of course, the final file was almost a gigabyte in size).</p>
<p>This led me to believe I should introduce lessons on multi-processing earlier than I was planing. We’ll come back to the Enron email corpus again in the future.</p>
<!--kg-card-end: markdown-->
    </section>


</article>



<aside class="read-more-wrap">
    <div class="read-more inner">


                    
<article class="post-card post no-image ">


    <div class="post-card-content">

        <a class="post-card-content-link" href="../awesome-python-library-tenacity/index.html">
            <header class="post-card-header">
                <h2 class="post-card-title">Awesome Python Library: Tenacity</h2>
            </header>
            <section class="post-card-excerpt">
                <p>Link: https://tenacity.readthedocs.io/en/latest/

When writing code or tests in Python, one issue I had was when the code would fail due to random things like network issues or external peripherals not responding in time. Just rerunning the tests would make them pass. The unreliability wasn&#39;</p>
            </section>
        </a>

        <footer class="post-card-meta">
            <ul class="author-list">
                <li class="author-list-item">
                    <a href="../../author/Shantnu/index.html" class="static-avatar">
                        <img class="author-profile-image" src="../../content/images/size/w100/2021/08/shantnu-foto-small-1.jpg" alt="Shantnu Tiwari" />
                    </a>
                </li>
            </ul>
            <div class="post-card-byline-content">
                <span><a href="../../author/Shantnu/index.html">Shantnu Tiwari</a></span>
                <span class="post-card-byline-date"><time datetime="2024-04-10">Apr 10, 2024</time> <span class="bull">&bull;</span> 2 min read</span>
            </div>
        </footer>

    </div>

</article>
                    
<article class="post-card post no-image ">


    <div class="post-card-content">

        <a class="post-card-content-link" href="../so-evidently/index.html">
            <header class="post-card-header">
                <h2 class="post-card-title">So Google&#x27;s Gemini Doesn&#x27;t Like Python Programming and Sanskrit?</h2>
            </header>
            <section class="post-card-excerpt">
                <p>I have been playing around with Googles Gemini Pro.

Recently, I wanted to write a blog on Python&#39;s decorators and wanted to get some ideas for practical projects I could build with them. Tried GPT4 first, it gave me the standard &quot;log analyser&quot; that all blogs</p>
            </section>
        </a>

        <footer class="post-card-meta">
            <ul class="author-list">
                <li class="author-list-item">
                    <a href="../../author/Shantnu/index.html" class="static-avatar">
                        <img class="author-profile-image" src="../../content/images/size/w100/2021/08/shantnu-foto-small-1.jpg" alt="Shantnu Tiwari" />
                    </a>
                </li>
            </ul>
            <div class="post-card-byline-content">
                <span><a href="../../author/Shantnu/index.html">Shantnu Tiwari</a></span>
                <span class="post-card-byline-date"><time datetime="2024-02-25">Feb 25, 2024</time> <span class="bull">&bull;</span> 4 min read</span>
            </div>
        </footer>

    </div>

</article>
                    
<article class="post-card post ">

    <a class="post-card-image-link" href="../linkedin-has-become-a-piece-of-garbage-even-more-than-usual/index.html">
        <img class="post-card-image"
            srcset="../../content/images/size/w300/2024/01/ae223740-840b-4d4a-9467-2522a67dcbbc.png 300w,
                   ../../content/images/size/w600/2024/01/ae223740-840b-4d4a-9467-2522a67dcbbc.pngg 600w,
                  ../../content/images/size/w1000/2024/01/ae223740-840b-4d4a-9467-2522a67dcbbc.pngng 1000w,
                 ../../content/images/size/w2000/2024/01/ae223740-840b-4d4a-9467-2522a67dcbbc.pngpng 2000w"
            sizes="(max-width: 1000px) 400px, 800px"
            src="../../content/images/size/w600/2024/01/ae223740-840b-4d4a-9467-2522a67dcbbc.png"
            alt="LinkedIn Has Become a Pile of Garbage (even more than usual)"
            loading="lazy"
        />
    </a>

    <div class="post-card-content">

        <a class="post-card-content-link" href="../linkedin-has-become-a-piece-of-garbage-even-more-than-usual/index.html">
            <header class="post-card-header">
                <h2 class="post-card-title">LinkedIn Has Become a Pile of Garbage (even more than usual)</h2>
            </header>
            <section class="post-card-excerpt">
                <p>Online forums, especially Hacker News and Reddit, are very hostile to LinkedIn. Everyone makes fun of the self-promotion and silliness that goes there. There are complaints the site is unusable, which I didn&#39;t agree with until now.

I&#39;ve had an account there for a few years.</p>
            </section>
        </a>

        <footer class="post-card-meta">
            <ul class="author-list">
                <li class="author-list-item">
                    <a href="../../author/Shantnu/index.html" class="static-avatar">
                        <img class="author-profile-image" src="../../content/images/size/w100/2021/08/shantnu-foto-small-1.jpg" alt="Shantnu Tiwari" />
                    </a>
                </li>
            </ul>
            <div class="post-card-byline-content">
                <span><a href="../../author/Shantnu/index.html">Shantnu Tiwari</a></span>
                <span class="post-card-byline-date"><time datetime="2024-01-29">Jan 29, 2024</time> <span class="bull">&bull;</span> 4 min read</span>
            </div>
        </footer>

    </div>

</article>

    </div>
</aside>


    </main>

    <footer class="site-footer outer">
        <div class="inner">
            <section class="copyright"><a href="../../home/index.html">Python for Engineers</a> &copy; 2025</section>
            <nav class="site-footer-nav">
                
            </nav>
            

        </div>
    </footer>

</div>


<script
    src="/assets/js/jquery-3.5.1.min.js"
    integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
    crossorigin="anonymous">
</script>
<script src="../../assets/built/casper.js"></script>
<script>
$(document).ready(function () {
    // Mobile Menu Trigger
    $('.gh-burger').click(function () {
        $('body').toggleClass('gh-head-open');
    });
    // FitVids - Makes video embeds responsive
    $(".gh-content").fitVids();
});
</script>

<script src="/assets/js/prism.min.js" integrity="sha512-axJX7DJduStuBB8ePC8ryGzacZPr3rdLaIDZitiEgWWk2gsXxEFlm4UW0iNzj2h3wp5mOylgHAzBzM4nRSvTZA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>



<script src="/assets/js/prism-toolbar.min.js" integrity="sha512-YrvgEHAi5/3o2OT+/vh1z19oJXk/Kk0qdVKbjEFl9VRmcLTaWRYzVziZCvoGpJ2TrnV7rB8pnJcz1ioVJjgw2A==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

</body>
</html>
